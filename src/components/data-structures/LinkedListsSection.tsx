"use client";

import { useState, useEffect } from "react";
import { List } from "lucide-react";
import { MermaidDiagram } from "~/components/common/MermaidDiagram";
import { RustCodeEditor } from "~/components/common/RustCodeEditor";
import { CppCodeEditor } from "~/components/common/CppCodeEditor";
import { PythonCodeEditor } from "~/components/common/PythonCodeEditor";
import { initRustWasm } from "~/lib/rust-wasm-helper";

interface ListNode {
  value: number;
  next?: ListNode;
}

export function LinkedListsSection() {
  const [rustLinkedList, setRustLinkedList] = useState<any>(null);
  const [wasmReady, setWasmReady] = useState(false);
  const [listDisplay, setListDisplay] = useState<number[]>([]);
  const [inputValue, setInputValue] = useState("");
  const [result, setResult] = useState("");
  const [wasm, setWasm] = useState<any>(null);
  const [activeLanguageTab, setActiveLanguageTab] = useState("rust");
  const [activeSection, setActiveSection] = useState<"overview" | "interactive" | "implementation">("overview");

  // Interactive visualization states
  const [animationList, setAnimationList] = useState<number[]>([10, 25, 8]);
  const [searchValue, setSearchValue] = useState("");
  const [insertValue, setInsertValue] = useState("");
  const [highlightedIndex, setHighlightedIndex] = useState<number | null>(null);
  const [animationStep, setAnimationStep] = useState<string>("");
  const [isAnimating, setIsAnimating] = useState(false);

  // Initialize WASM
  useEffect(() => {
    async function init() {
      try {
        const wasmInstance = await initRustWasm();
        const newLinkedList = wasmInstance.dataStructures.createLinkedList();
        setRustLinkedList(newLinkedList);
        setWasm(wasmInstance);
        setWasmReady(true);
        setResult("‚úÖ Rust WASM Linked List ƒë√£ s·∫µn s√†ng!");
      } catch (error) {
        console.error("Failed to initialize WASM:", error);
        setResult("‚ùå Kh√¥ng th·ªÉ kh·ªüi t·∫°o Rust WASM");
      }
    }
    init();
  }, []);

  // Update display from Rust linked list
  const updateDisplayFromRustList = () => {
    if (rustLinkedList) {
      try {
        const listArray = Array.from(rustLinkedList.to_array()) as number[];
        setListDisplay(listArray);
      } catch (error) {
        console.error("Error updating display:", error);
      }
    }
  };

  const addToHead = () => {
    const value = parseInt(inputValue);
    if (!isNaN(value)) {
      if (wasmReady && rustLinkedList) {
        try {
          rustLinkedList.push_front(value);
          const listSize = rustLinkedList.len();
          setResult(`ü¶Ä ƒê√£ th√™m ${value} v√†o ƒë·∫ßu danh s√°ch. K√≠ch th∆∞·ªõc: ${listSize}`);
          updateDisplayFromRustList();
          setInputValue("");
        } catch (error) {
          setResult("‚ùå Rust WASM addToHead failed: " + error);
        }
      } else {
        setResult("‚ùå WASM ch∆∞a s·∫µn s√†ng");
      }
    }
  };

  const addToTail = () => {
    const value = parseInt(inputValue);
    if (!isNaN(value)) {
      if (wasmReady && rustLinkedList) {
        try {
          rustLinkedList.push_back(value);
          const listSize = rustLinkedList.len();
          setResult(`ü¶Ä ƒê√£ th√™m ${value} v√†o cu·ªëi danh s√°ch. K√≠ch th∆∞·ªõc: ${listSize}`);
          updateDisplayFromRustList();
          setInputValue("");
        } catch (error) {
          setResult("‚ùå Rust WASM addToTail failed: " + error);
        }
      } else {
        setResult("‚ùå WASM ch∆∞a s·∫µn s√†ng");
      }
    }
  };

  const removeHead = () => {
    if (wasmReady && rustLinkedList) {
      try {
        const removed = rustLinkedList.pop_front();
        const listSize = rustLinkedList.len();
        if (removed !== null && removed !== undefined) {
          setResult(`ü¶Ä ƒê√£ x√≥a ph·∫ßn t·ª≠ ƒë·∫ßu: ${removed}. K√≠ch th∆∞·ªõc: ${listSize}`);
        } else {
          setResult(`ü¶Ä Danh s√°ch tr·ªëng, kh√¥ng th·ªÉ x√≥a`);
        }
        updateDisplayFromRustList();
      } catch (error) {
        setResult("‚ùå Rust WASM removeHead failed: " + error);
      }
    } else {
      setResult("‚ùå WASM ch∆∞a s·∫µn s√†ng");
    }
  };

  const removeTail = () => {
    if (wasmReady && rustLinkedList) {
      try {
        const removed = rustLinkedList.pop_back();
        const listSize = rustLinkedList.len();
        if (removed !== null && removed !== undefined) {
          setResult(`ü¶Ä ƒê√£ x√≥a ph·∫ßn t·ª≠ cu·ªëi: ${removed}. K√≠ch th∆∞·ªõc: ${listSize}`);
        } else {
          setResult(`ü¶Ä Danh s√°ch tr·ªëng, kh√¥ng th·ªÉ x√≥a`);
        }
        updateDisplayFromRustList();
      } catch (error) {
        setResult("‚ùå Rust WASM removeTail failed: " + error);
      }
    } else {
      setResult("‚ùå WASM ch∆∞a s·∫µn s√†ng");
    }
  };

  const clear = () => {
    if (wasmReady && rustLinkedList) {
      try {
        rustLinkedList.clear();
        setResult("ü¶Ä ƒê√£ x√≥a to√†n b·ªô danh s√°ch");
        updateDisplayFromRustList();
      } catch (error) {
        setResult("‚ùå Rust WASM clear failed: " + error);
      }
    } else {
      setResult("‚ùå WASM ch∆∞a s·∫µn s√†ng");
    }
  };

  // Animation functions for interactive visualization
  const sleep = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));

  const animateSearch = async () => {
    const searchVal = parseInt(searchValue);
    if (isNaN(searchVal)) {
      setAnimationStep("‚ùå Gi√° tr·ªã t√¨m ki·∫øm kh√¥ng h·ª£p l·ªá!");
      return;
    }

    setIsAnimating(true);
    setAnimationStep(`üîç B·∫Øt ƒë·∫ßu t√¨m ki·∫øm gi√° tr·ªã ${searchVal} trong linked list...`);
    await sleep(1000);

    // Traverse the linked list
    for (let i = 0; i < animationList.length; i++) {
      setHighlightedIndex(i);
      setAnimationStep(`üîç Node ${i}: ${animationList[i]} ${animationList[i] === searchVal ? '= ‚úÖ' : '‚â†'} ${searchVal}`);
      await sleep(1200);

      if (animationList[i] === searchVal) {
        setAnimationStep(`üéâ T√¨m th·∫•y ${searchVal} t·∫°i node ${i}! (ƒê·ªô ph·ª©c t·∫°p: O(n))`);
        await sleep(2000);
        setHighlightedIndex(null);
        setIsAnimating(false);
        return;
      }
    }

    setAnimationStep(`‚ùå Kh√¥ng t√¨m th·∫•y ${searchVal} trong linked list! (ƒê√£ duy·ªát ${animationList.length} nodes)`);
    await sleep(2000);
    setHighlightedIndex(null);
    setIsAnimating(false);
  };

  const animateInsertHead = async () => {
    const newValue = parseInt(insertValue);
    if (isNaN(newValue)) return;

    setIsAnimating(true);
    setAnimationStep(`‚ûï Th√™m ${newValue} v√†o ƒë·∫ßu linked list...`);
    await sleep(1000);

    setAnimationList([newValue, ...animationList]);
    setHighlightedIndex(0);
    setAnimationStep(`‚úÖ ƒê√£ th√™m ${newValue} v√†o ƒë·∫ßu! K√≠ch th∆∞·ªõc: ${animationList.length + 1} (ƒê·ªô ph·ª©c t·∫°p: O(1))`);
    await sleep(2000);

    setHighlightedIndex(null);
    setIsAnimating(false);
    setInsertValue("");
  };

  const animateInsertTail = async () => {
    const newValue = parseInt(insertValue);
    if (isNaN(newValue)) return;

    setIsAnimating(true);
    setAnimationStep(`‚ûï Th√™m ${newValue} v√†o cu·ªëi linked list...`);

    // Show traversal to end
    for (let i = 0; i < animationList.length; i++) {
      setHighlightedIndex(i);
      setAnimationStep(`üö∂ Duy·ªát ƒë·∫øn node ${i} ƒë·ªÉ t√¨m cu·ªëi list...`);
      await sleep(600);
    }

    setAnimationList([...animationList, newValue]);
    setHighlightedIndex(animationList.length);
    setAnimationStep(`‚úÖ ƒê√£ th√™m ${newValue} v√†o cu·ªëi! K√≠ch th∆∞·ªõc: ${animationList.length + 1} (ƒê·ªô ph·ª©c t·∫°p: O(n))`);
    await sleep(2000);

    setHighlightedIndex(null);
    setIsAnimating(false);
    setInsertValue("");
  };

  const animateRemoveHead = async () => {
    if (animationList.length === 0) {
      setAnimationStep("‚ùå Linked list ƒë√£ r·ªóng!");
      return;
    }

    setIsAnimating(true);
    const removedValue = animationList[0];

    setHighlightedIndex(0);
    setAnimationStep(`‚ûñ X√≥a node ƒë·∫ßu: ${removedValue}...`);
    await sleep(1000);

    setAnimationList(animationList.slice(1));
    setAnimationStep(`‚úÖ ƒê√£ x√≥a ${removedValue}! K√≠ch th∆∞·ªõc: ${animationList.length - 1} (ƒê·ªô ph·ª©c t·∫°p: O(1))`);
    await sleep(2000);

    setHighlightedIndex(null);
    setIsAnimating(false);
  };

  const animateRemoveTail = async () => {
    if (animationList.length === 0) {
      setAnimationStep("‚ùå Linked list ƒë√£ r·ªóng!");
      return;
    }

    setIsAnimating(true);
    const lastIndex = animationList.length - 1;
    const removedValue = animationList[lastIndex];

    // Show traversal to find the second-to-last node
    for (let i = 0; i < lastIndex; i++) {
      setHighlightedIndex(i);
      setAnimationStep(`üö∂ Duy·ªát ƒë·∫øn node ${i} ƒë·ªÉ t√¨m node cu·ªëi...`);
      await sleep(600);
    }

    setHighlightedIndex(lastIndex);
    setAnimationStep(`‚ûñ X√≥a node cu·ªëi: ${removedValue}...`);
    await sleep(1000);

    setAnimationList(animationList.slice(0, -1));
    setAnimationStep(`‚úÖ ƒê√£ x√≥a ${removedValue}! K√≠ch th∆∞·ªõc: ${animationList.length - 1} (ƒê·ªô ph·ª©c t·∫°p: O(n))`);
    await sleep(2000);

    setHighlightedIndex(null);
    setIsAnimating(false);
  };

  const resetLinkedList = () => {
    setAnimationList([10, 25, 8]);
    setHighlightedIndex(null);
    setAnimationStep("");
  };

  return (
    <div className="max-w-7xl mx-auto space-y-6">
      {/* Header Section with Navigation Pills */}
      <div className="bg-gradient-to-br from-green-50 via-teal-50 to-emerald-50 dark:from-slate-800 dark:via-slate-800 dark:to-slate-700 rounded-xl p-6 border border-green-100 dark:border-slate-600 shadow-md">
        <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
          <div>
            <h3 className="text-2xl font-bold mb-2 flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent">
              <List className="h-6 w-6 text-green-500" />
              Danh S√°ch Li√™n K·∫øt
            </h3>
            <p className="text-gray-600 dark:text-gray-300 text-base leading-relaxed max-w-2xl">
              Kh√°m ph√° c·∫•u tr√∫c d·ªØ li·ªáu ƒë·ªông v·ªõi c√°c node li√™n k·∫øt th√¥ng qua pointer.
            </p>
          </div>

          {/* Navigation Pills */}
          <div className="flex bg-white dark:bg-slate-800 rounded-lg p-1 shadow-sm border border-gray-200 dark:border-slate-600">
            <button
              onClick={() => setActiveSection("overview")}
              className={`px-4 py-2 rounded-md font-medium text-sm transition-all duration-200 ${
                activeSection === "overview"
                  ? "bg-green-500 text-white shadow-sm"
                  : "text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700"
              }`}
            >
              üìö T·ªïng quan
            </button>
            <button
              onClick={() => setActiveSection("interactive")}
              className={`px-4 py-2 rounded-md font-medium text-sm transition-all duration-200 ${
                activeSection === "interactive"
                  ? "bg-teal-500 text-white shadow-sm"
                  : "text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700"
              }`}
            >
              üéÆ T∆∞∆°ng t√°c
            </button>
            <button
              onClick={() => setActiveSection("implementation")}
              className={`px-4 py-2 rounded-md font-medium text-sm transition-all duration-200 ${
                activeSection === "implementation"
                  ? "bg-emerald-500 text-white shadow-sm"
                  : "text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700"
              }`}
            >
              üíª C√†i ƒë·∫∑t
            </button>
          </div>
        </div>
      </div>

      {/* Overview Section */}
      {activeSection === "overview" && (
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Linked List Definition */}
          <div className="bg-white dark:bg-slate-800 rounded-xl p-5 border border-green-200 dark:border-slate-600 shadow-md hover:shadow-lg transition-shadow">
            <div className="flex items-center gap-2 mb-3">
              <div className="p-1.5 bg-green-100 dark:bg-green-900/30 rounded-lg">
                üîó
              </div>
              <h4 className="text-lg font-bold text-green-800 dark:text-green-300">Danh S√°ch Li√™n K·∫øt</h4>
            </div>
            <p className="text-gray-700 dark:text-gray-300 mb-3 text-sm leading-relaxed">
              C·∫•u tr√∫c d·ªØ li·ªáu tuy·∫øn t√≠nh v·ªõi c√°c node ƒë∆∞·ª£c l∆∞u tr·ªØ kh√¥ng li√™n ti·∫øp trong b·ªô nh·ªõ.
              M·ªói node ch·ª©a d·ªØ li·ªáu v√† pointer ƒë·∫øn node ti·∫øp theo.
            </p>

            <div className="space-y-2">
              <div className="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-200 dark:border-green-800">
                <h5 className="font-semibold text-green-700 dark:text-green-300 mb-2 flex items-center gap-2">
                  ‚úÖ ∆Øu ƒëi·ªÉm
                </h5>
                <ul className="space-y-1 text-sm text-gray-600 dark:text-gray-300">
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full"></span>
                    K√≠ch th∆∞·ªõc ƒë·ªông
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full"></span>
                    Th√™m/x√≥a ƒë·∫ßu nhanh O(1)
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-green-500 rounded-full"></span>
                    Kh√¥ng c·∫ßn bi·∫øt tr∆∞·ªõc k√≠ch th∆∞·ªõc
                  </li>
                </ul>
              </div>

              <div className="bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800">
                <h5 className="font-semibold text-red-700 dark:text-red-300 mb-2 flex items-center gap-2">
                  ‚ùå Nh∆∞·ª£c ƒëi·ªÉm
                </h5>
                <ul className="space-y-1 text-sm text-gray-600 dark:text-gray-300">
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full"></span>
                    Truy c·∫≠p ch·∫≠m O(n)
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full"></span>
                    T·ªën b·ªô nh·ªõ cho pointer
                  </li>
                  <li className="flex items-center gap-2">
                    <span className="w-1.5 h-1.5 bg-red-500 rounded-full"></span>
                    Kh√¥ng cache-friendly
                  </li>
                </ul>
              </div>
            </div>
          </div>

          {/* Use Cases & Applications */}
          <div className="bg-white dark:bg-slate-800 rounded-xl p-5 border border-teal-200 dark:border-slate-600 shadow-md hover:shadow-lg transition-shadow">
            <div className="flex items-center gap-2 mb-3">
              <div className="p-1.5 bg-teal-100 dark:bg-teal-900/30 rounded-lg">
                üéØ
              </div>
              <h4 className="text-lg font-bold text-teal-800 dark:text-teal-300">·ª®ng D·ª•ng Th·ª±c T·∫ø</h4>
            </div>
            <p className="text-gray-700 dark:text-gray-300 mb-3 text-sm leading-relaxed">
              Linked List ph√π h·ª£p cho c√°c tr∆∞·ªùng h·ª£p c·∫ßn th√™m/x√≥a th∆∞·ªùng xuy√™n v√† kh√¥ng c·∫ßn truy c·∫≠p ng·∫´u nhi√™n.
            </p>

            <div className="space-y-3">
              <div className="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800">
                <h6 className="font-semibold text-blue-700 dark:text-blue-300 mb-2">üé™ ·ª®ng d·ª•ng ph·ªï bi·∫øn</h6>
                <ul className="space-y-1 text-sm text-gray-600 dark:text-gray-300">
                  <li>‚Ä¢ Undo/Redo trong text editor</li>
                  <li>‚Ä¢ Browser history navigation</li>
                  <li>‚Ä¢ Music playlist management</li>
                  <li>‚Ä¢ Implement Stack/Queue</li>
                </ul>
              </div>

              {/* Complexity Comparison */}
              <div className="bg-gray-50 dark:bg-slate-700 rounded-lg p-3 border">
                <h5 className="font-medium mb-2 text-gray-800 dark:text-gray-200 text-sm">So v·ªõi Array</h5>
                <div className="grid grid-cols-2 gap-2 text-xs">
                  <div className="flex justify-between items-center p-2 bg-white dark:bg-slate-800 rounded border">
                    <span>Truy c·∫≠p:</span>
                    <span className="font-mono bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-2 py-1 rounded">O(n)</span>
                  </div>
                  <div className="flex justify-between items-center p-2 bg-white dark:bg-slate-800 rounded border">
                    <span>T√¨m ki·∫øm:</span>
                    <span className="font-mono bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-2 py-1 rounded">O(n)</span>
                  </div>
                  <div className="flex justify-between items-center p-2 bg-white dark:bg-slate-800 rounded border">
                    <span>Th√™m ƒë·∫ßu:</span>
                    <span className="font-mono bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded">O(1)</span>
                  </div>
                  <div className="flex justify-between items-center p-2 bg-white dark:bg-slate-800 rounded border">
                    <span>X√≥a ƒë·∫ßu:</span>
                    <span className="font-mono bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded">O(1)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Interactive Section */}
      {activeSection === "interactive" && (
        <div className="space-y-6">
          {/* Interactive Linked List Visualization */}
          <div className="bg-gradient-to-br from-green-50 via-teal-50 to-emerald-50 dark:from-green-900/20 dark:via-teal-900/20 dark:to-emerald-900/20 rounded-xl p-6 border border-green-200 dark:border-green-800 shadow-md">
            <div className="flex items-center gap-2 mb-4">
              <div className="p-2 bg-gradient-to-r from-green-500 to-teal-500 rounded-full text-white text-sm">
                üéÆ
              </div>
              <div>
                <h4 className="text-lg font-bold text-green-800 dark:text-green-300">
                  Minh H·ªça T∆∞∆°ng T√°c
                </h4>
                <p className="text-gray-600 dark:text-gray-400 text-sm">
                  Thao t√°c tr·ª±c ti·∫øp v·ªõi linked list ƒë·ªÉ hi·ªÉu r√µ c√°ch ho·∫°t ƒë·ªông
                </p>
              </div>
            </div>

            {/* Linked List Visualization */}
            <div className="mb-6">
              <div className="flex items-center justify-center mb-6 overflow-x-auto pb-4">
                <div className="flex items-center gap-3 min-w-max">
                  {/* HEAD pointer */}
                  {animationList.length > 0 && (
                    <div className="flex flex-col items-center">
                      <div className="text-xs text-gray-500 dark:text-gray-400 mb-1 h-4">HEAD</div>
                      <div className="bg-orange-500 text-white px-2 py-2 rounded font-bold text-sm">
                        ‚Üí
                      </div>
                    </div>
                  )}

                  {/* Linked List Nodes */}
                  {animationList.map((value, index) => (
                    <div key={`${index}-${value}`} className="flex items-center gap-2">
                      {/* Node */}
                      <div className="flex flex-col items-center group">
                        <div className="text-xs font-medium text-gray-600 dark:text-gray-400 mb-1 h-4">
                          Node {index}
                        </div>
                        <div
                          className={`flex items-center border-2 rounded-lg transition-all duration-500 ${
                            highlightedIndex === index
                              ? "border-red-500 scale-110 shadow-xl"
                              : "border-green-300 dark:border-green-600 hover:scale-105"
                          }`}
                        >
                          {/* Data part */}
                          <div
                            className={`px-3 py-2 rounded-l-lg font-bold text-base ${
                              highlightedIndex === index
                                ? "bg-yellow-400 animate-pulse text-black"
                                : "bg-green-100 dark:bg-green-800 group-hover:bg-green-200 dark:group-hover:bg-green-700"
                            }`}
                          >
                            {value}
                          </div>
                          {/* Pointer part */}
                          <div
                            className={`px-2 py-2 rounded-r-lg text-sm font-mono ${
                              highlightedIndex === index
                                ? "bg-yellow-300 text-black"
                                : "bg-green-200 dark:bg-green-700 group-hover:bg-green-300 dark:group-hover:bg-green-600"
                            }`}
                          >
                            {index < animationList.length - 1 ? "‚Üí" : "‚àÖ"}
                          </div>
                        </div>
                      </div>

                      {/* Arrow between nodes */}
                      {index < animationList.length - 1 && (
                        <div className="text-green-500 text-xl">‚Üí</div>
                      )}
                    </div>
                  ))}

                  {/* NULL at the end */}
                  {animationList.length > 0 && (
                    <div className="flex flex-col items-center">
                      <div className="text-xs text-gray-500 dark:text-gray-400 mb-1 h-4">NULL</div>
                      <div className="bg-red-500 text-white px-2 py-2 rounded font-bold text-sm">
                        ‚àÖ
                      </div>
                    </div>
                  )}

                  {animationList.length === 0 && (
                    <div className="text-gray-500 italic text-center p-8 bg-gray-50 dark:bg-slate-700 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600">
                      <div className="text-2xl mb-1">üîó</div>
                      <div className="text-sm font-semibold mb-1">Linked List r·ªóng</div>
                      <div className="text-xs">H√£y th√™m node ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                    </div>
                  )}
                </div>
              </div>

              {/* Animation status */}
              {animationStep && (
                <div className="bg-gradient-to-r from-orange-100 to-yellow-100 dark:from-orange-900/30 dark:to-yellow-900/30 border-2 border-orange-300 dark:border-orange-700 rounded-xl p-4 mb-6 shadow-md">
                  <div className="flex items-center gap-3">
                    <div className={isAnimating ? "animate-spin" : ""}>‚ö°</div>
                    <div className="font-semibold text-orange-800 dark:text-orange-300 text-lg">
                      {animationStep}
                    </div>
                  </div>
                </div>
              )}

              {/* List info */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-gray-200 dark:border-slate-600 shadow-sm">
                  <div className="flex items-center gap-3">
                    <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">üîó</div>
                    <div>
                      <div className="text-sm text-gray-600 dark:text-gray-400">Nodes</div>
                      <div className="text-xl font-bold text-blue-600 dark:text-blue-400">{animationList.length}</div>
                    </div>
                  </div>
                </div>
                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-gray-200 dark:border-slate-600 shadow-sm">
                  <div className="flex items-center gap-3">
                    <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">üìç</div>
                    <div>
                      <div className="text-sm text-gray-600 dark:text-gray-400">Head</div>
                      <div className="text-xl font-bold text-green-600 dark:text-green-400">
                        {animationList.length > 0 ? animationList[0] : "NULL"}
                      </div>
                    </div>
                  </div>
                </div>
                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-gray-200 dark:border-slate-600 shadow-sm">
                  <div className="flex items-center gap-3">
                    <div className="p-2 bg-red-100 dark:bg-red-900/30 rounded-lg">üéØ</div>
                    <div>
                      <div className="text-sm text-gray-600 dark:text-gray-400">Tail</div>
                      <div className="text-xl font-bold text-red-600 dark:text-red-400">
                        {animationList.length > 0 ? animationList[animationList.length - 1] : "NULL"}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Interactive Controls */}
            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
              {/* Search */}
              <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-blue-200 dark:border-slate-600 shadow-md hover:shadow-lg transition-all group">
                <div className="flex items-center gap-2 mb-3">
                  <div className="p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg group-hover:scale-110 transition-transform">
                    üîç
                  </div>
                  <div>
                    <h5 className="font-bold text-blue-700 dark:text-blue-400 text-sm">T√¨m Ki·∫øm</h5>
                    <p className="text-xs text-blue-600 dark:text-blue-500 font-mono">O(n)</p>
                  </div>
                </div>
                <div className="space-y-2">
                  <input
                    type="number"
                    value={searchValue}
                    onChange={(e) => setSearchValue(e.target.value)}
                    placeholder="Nh·∫≠p gi√° tr·ªã c·∫ßn t√¨m"
                    className="w-full px-3 py-2 border-2 border-blue-200 dark:border-blue-700 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-slate-700 transition-all"
                    disabled={isAnimating}
                  />
                  <button
                    onClick={animateSearch}
                    disabled={isAnimating || animationList.length === 0}
                    className="w-full px-3 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-medium text-sm rounded-md hover:from-blue-600 hover:to-cyan-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                  >
                    üîç T√¨m ki·∫øm
                  </button>
                </div>
              </div>

              {/* Insert at Head */}
              <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-green-200 dark:border-slate-600 shadow-md hover:shadow-lg transition-all group">
                <div className="flex items-center gap-2 mb-3">
                  <div className="p-1.5 bg-green-100 dark:bg-green-900/30 rounded-lg group-hover:scale-110 transition-transform">
                    ‚ûï
                  </div>
                  <div>
                    <h5 className="font-bold text-green-700 dark:text-green-400 text-sm">Th√™m ƒê·∫ßu</h5>
                    <p className="text-xs text-green-600 dark:text-green-500 font-mono">O(1)</p>
                  </div>
                </div>
                <div className="space-y-2">
                  <input
                    type="number"
                    value={insertValue}
                    onChange={(e) => setInsertValue(e.target.value)}
                    placeholder="Nh·∫≠p gi√° tr·ªã m·ªõi"
                    className="w-full px-3 py-2 border-2 border-green-200 dark:border-green-700 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 dark:bg-slate-700 transition-all"
                    disabled={isAnimating}
                  />
                  <button
                    onClick={animateInsertHead}
                    disabled={isAnimating}
                    className="w-full px-3 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium text-sm rounded-md hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                  >
                    ‚ûï Th√™m ƒë·∫ßu
                  </button>
                </div>
              </div>

              {/* Insert at Tail */}
              <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-purple-200 dark:border-slate-600 shadow-md hover:shadow-lg transition-all group">
                <div className="flex items-center gap-2 mb-3">
                  <div className="p-1.5 bg-purple-100 dark:bg-purple-900/30 rounded-lg group-hover:scale-110 transition-transform">
                    ‚ûï
                  </div>
                  <div>
                    <h5 className="font-bold text-purple-700 dark:text-purple-400 text-sm">Th√™m Cu·ªëi</h5>
                    <p className="text-xs text-purple-600 dark:text-purple-500 font-mono">O(n)</p>
                  </div>
                </div>
                <div className="space-y-2">
                  <button
                    onClick={animateInsertTail}
                    disabled={isAnimating || !insertValue}
                    className="w-full px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium text-sm rounded-md hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                  >
                    ‚ûï Th√™m cu·ªëi
                  </button>
                  <button
                    onClick={animateRemoveHead}
                    disabled={isAnimating || animationList.length === 0}
                    className="w-full px-3 py-2 bg-gradient-to-r from-red-500 to-rose-500 text-white font-medium text-sm rounded-md hover:from-red-600 hover:to-rose-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                  >
                    ‚ûñ X√≥a ƒë·∫ßu
                  </button>
                </div>
              </div>

              {/* Remove and Reset */}
              <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-orange-200 dark:border-slate-600 shadow-md hover:shadow-lg transition-all group">
                <div className="flex items-center gap-2 mb-3">
                  <div className="p-1.5 bg-orange-100 dark:bg-orange-900/30 rounded-lg group-hover:scale-110 transition-transform">
                    üõ†Ô∏è
                  </div>
                  <div>
                    <h5 className="font-bold text-orange-700 dark:text-orange-400 text-sm">ƒêi·ªÅu Khi·ªÉn</h5>
                    <p className="text-xs text-orange-600 dark:text-orange-500">Qu·∫£n l√Ω list</p>
                  </div>
                </div>
                <div className="space-y-2">
                  <button
                    onClick={animateRemoveTail}
                    disabled={isAnimating || animationList.length === 0}
                    className="w-full px-3 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white font-medium text-sm rounded-md hover:from-orange-600 hover:to-amber-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                  >
                    ‚ûñ X√≥a cu·ªëi
                  </button>
                  <button
                    onClick={resetLinkedList}
                    disabled={isAnimating}
                    className="w-full px-3 py-2 bg-gradient-to-r from-gray-500 to-slate-500 text-white font-medium text-sm rounded-md hover:from-gray-600 hover:to-slate-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                  >
                    üîÑ Reset
                  </button>
                </div>
              </div>
            </div>

            {/* Operation Explanations */}
            <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-6 rounded-xl border border-green-200 dark:border-green-800 shadow-md">
                <div className="flex items-center gap-3 mb-3">
                  <div className="p-2 bg-green-100 dark:bg-green-900/50 rounded-lg">
                    ‚ö°
                  </div>
                  <h6 className="font-bold text-green-700 dark:text-green-300">Th√™m v√†o ƒë·∫ßu O(1)</h6>
                </div>
                <p className="text-gray-600 dark:text-gray-400 leading-relaxed">
                  Ch·ªâ c·∫ßn t·∫°o node m·ªõi v√† c·∫≠p nh·∫≠t pointer HEAD, kh√¥ng ph·ª• thu·ªôc v√†o k√≠ch th∆∞·ªõc list.
                  Thao t√°c n√†y lu√¥n nhanh v√† hi·ªáu qu·∫£.
                </p>
              </div>
              <div className="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 p-6 rounded-xl border border-blue-200 dark:border-blue-800 shadow-md">
                <div className="flex items-center gap-3 mb-3">
                  <div className="p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                    üîç
                  </div>
                  <h6 className="font-bold text-blue-700 dark:text-blue-300">T√¨m ki·∫øm/Th√™m cu·ªëi O(n)</h6>
                </div>
                <p className="text-gray-600 dark:text-gray-400 leading-relaxed">
                  Ph·∫£i duy·ªát t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi ƒë·ªÉ t√¨m v·ªã tr√≠ c·∫ßn thi·∫øt.
                  Tr∆∞·ªùng h·ª£p x·∫•u nh·∫•t: ki·ªÉm tra t·∫•t c·∫£ n node.
                </p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Implementation Section */}
      {activeSection === "implementation" && (
        <div className="space-y-6">
          {/* WASM LinkedList Demo */}
          <div className="bg-white dark:bg-slate-800 rounded-xl p-6 border border-gray-200 dark:border-slate-600 shadow-md">
            <div className="flex items-center gap-2 mb-4">
              <div className="p-2 bg-gradient-to-r from-orange-500 to-amber-500 rounded-full text-white text-sm">
                ü¶Ä
              </div>
              <div>
                <h4 className="text-lg font-bold text-orange-800 dark:text-orange-300">
                  Rust WASM LinkedList
                </h4>
                <p className="text-gray-600 dark:text-gray-400 text-sm">
                  Demo t∆∞∆°ng t√°c v·ªõi Rust WebAssembly
                </p>
              </div>
            </div>

            <div className="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-xl border border-orange-200 dark:border-orange-800">
              <div className="flex gap-3 mb-4 flex-wrap">
                <input
                  type="number"
                  value={inputValue}
                  onChange={(e) => setInputValue(e.target.value)}
                  placeholder="Nh·∫≠p s·ªë"
                  className="flex-1 min-w-[120px] px-4 py-2 border-2 border-orange-200 dark:border-orange-700 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 dark:bg-slate-700 transition-all"
                />
                <button
                  onClick={addToHead}
                  disabled={!wasmReady}
                  className="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium text-sm rounded-md hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 transition-all"
                >
                  ü¶Ä Th√™m ƒë·∫ßu
                </button>
                <button
                  onClick={addToTail}
                  disabled={!wasmReady}
                  className="px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-medium text-sm rounded-md hover:from-blue-600 hover:to-cyan-600 disabled:opacity-50 transition-all"
                >
                  ü¶Ä Th√™m cu·ªëi
                </button>
                <button
                  onClick={removeHead}
                  disabled={!wasmReady}
                  className="px-4 py-2 bg-gradient-to-r from-red-500 to-rose-500 text-white font-medium text-sm rounded-md hover:from-red-600 hover:to-rose-600 disabled:opacity-50 transition-all"
                >
                  ü¶Ä X√≥a ƒë·∫ßu
                </button>
                <button
                  onClick={removeTail}
                  disabled={!wasmReady}
                  className="px-4 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white font-medium text-sm rounded-md hover:from-orange-600 hover:to-amber-600 disabled:opacity-50 transition-all"
                >
                  ü¶Ä X√≥a cu·ªëi
                </button>
                <button
                  onClick={clear}
                  disabled={!wasmReady}
                  className="px-4 py-2 bg-gradient-to-r from-gray-500 to-slate-500 text-white font-medium text-sm rounded-md hover:from-gray-600 hover:to-slate-600 disabled:opacity-50 transition-all"
                >
                  üßπ X√≥a t·∫•t c·∫£
                </button>
              </div>

              {result && (
                <div className="mb-4 p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg border border-orange-200 dark:border-orange-700">
                  <strong>K·∫øt qu·∫£:</strong> {result}
                </div>
              )}

              <div className="flex items-center gap-2 text-sm overflow-x-auto min-h-[60px] items-center">
                {listDisplay.length === 0 ? (
                  <div className="text-gray-500 italic text-center flex-1 py-4">
                    üîó LinkedList r·ªóng - H√£y th√™m node
                  </div>
                ) : (
                  <>
                    <div className="bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold">ü¶Ä HEAD</div>
                    {listDisplay.map((value, index) => (
                      <div key={index} className="flex items-center gap-2">
                        <div className="border-2 border-orange-500 rounded-lg bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-shadow">
                          <div className="p-2">
                            <div className="text-xs text-gray-600 dark:text-gray-300 font-semibold">Data: {value}</div>
                            <div className="text-xs text-gray-600 dark:text-gray-300">
                              Next: {index < listDisplay.length - 1 ? "‚Üí" : "NULL"}
                            </div>
                          </div>
                        </div>
                        {index < listDisplay.length - 1 && <span className="text-orange-500 text-lg">‚Üí</span>}
                      </div>
                    ))}
                    <span className="text-red-500 font-bold">NULL</span>
                  </>
                )}
              </div>
            </div>
          </div>

          {/* Code Implementation */}
          <div className="bg-white dark:bg-slate-800 rounded-xl p-6 border border-gray-200 dark:border-slate-600 shadow-md">
            <div className="flex items-center gap-2 mb-4">
              <div className="p-2 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full text-white text-sm">
                üíª
              </div>
              <div>
                <h4 className="text-lg font-bold text-emerald-800 dark:text-emerald-300">
                  C√†i ƒê·∫∑t Chi Ti·∫øt
                </h4>
                <p className="text-gray-600 dark:text-gray-400 text-sm">
                  M√£ ngu·ªìn trong c√°c ng√¥n ng·ªØ ph·ªï bi·∫øn
                </p>
              </div>
            </div>

            {/* Language Tabs */}
            <div className="mb-4">
              <div className="flex bg-gray-100 dark:bg-slate-700 rounded-lg p-1 w-fit">
                <button
                  onClick={() => setActiveLanguageTab("rust")}
                  className={`px-4 py-2 rounded-md font-medium text-sm transition-all ${
                    activeLanguageTab === "rust"
                      ? "bg-orange-500 text-white shadow-sm"
                      : "text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-slate-600"
                  }`}
                >
                  ü¶Ä Rust
                </button>
                <button
                  onClick={() => setActiveLanguageTab("cpp")}
                  className={`px-4 py-2 rounded-md font-medium text-sm transition-all ${
                    activeLanguageTab === "cpp"
                      ? "bg-blue-500 text-white shadow-sm"
                      : "text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-slate-600"
                  }`}
                >
                  ‚ö° C++
                </button>
                <button
                  onClick={() => setActiveLanguageTab("python")}
                  className={`px-4 py-2 rounded-md font-medium text-sm transition-all ${
                    activeLanguageTab === "python"
                      ? "bg-green-500 text-white shadow-sm"
                      : "text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-slate-600"
                  }`}
                >
                  üêç Python
                </button>
              </div>
            </div>

            <div className="bg-gray-50 dark:bg-slate-700 rounded-xl p-6 border">

              {/* Language-specific Code */}
              {activeLanguageTab === "rust" && (
                <div className="space-y-4">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="p-2 bg-orange-100 dark:bg-orange-900/30 rounded">ü¶Ä</div>
                    <h5 className="text-lg font-bold text-orange-700 dark:text-orange-300">LinkedList trong Rust</h5>
                  </div>
                  <RustCodeEditor
              code={`#[derive(Debug)]
struct Node<T> {
    data: T,
    next: Option<Box<Node<T>>>,
}

#[derive(Debug)]
struct LinkedList<T> {
    head: Option<Box<Node<T>>>,
    size: usize,
}

impl<T> LinkedList<T> {
    fn new() -> Self {
        LinkedList { head: None, size: 0 }
    }

    fn push_front(&mut self, data: T) {
        let new_node = Box::new(Node {
            data,
            next: self.head.take(),
        });
        self.head = Some(new_node);
        self.size += 1;
    }

    fn pop_front(&mut self) -> Option<T> {
        self.head.take().map(|node| {
            self.head = node.next;
            self.size -= 1;
            node.data
        })
    }

    fn push_back(&mut self, data: T) {
        let new_node = Box::new(Node {
            data,
            next: None,
        });

        if self.head.is_none() {
            self.head = Some(new_node);
        } else {
            let mut current = self.head.as_mut().unwrap();
            while current.next.is_some() {
                current = current.next.as_mut().unwrap();
            }
            current.next = Some(new_node);
        }
        self.size += 1;
    }

    fn display(&self) -> Vec<&T> {
        let mut result = Vec::new();
        let mut current = &self.head;

        while let Some(node) = current {
            result.push(&node.data);
            current = &node.next;
        }

        result
    }
}`}
                    height="300px"
                  />
                </div>
              )}

              {activeLanguageTab === "cpp" && (
                <div className="space-y-4">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded">‚ö°</div>
                    <h5 className="text-lg font-bold text-blue-700 dark:text-blue-300">LinkedList trong C++</h5>
                  </div>
                  <CppCodeEditor
                code={`#include <iostream>
#include <memory>

template<typename T>
class LinkedList {
private:
    struct Node {
        T data;
        std::unique_ptr<Node> next;

        Node(const T& value) : data(value), next(nullptr) {}
    };

    std::unique_ptr<Node> head;
    size_t size;

public:
    LinkedList() : head(nullptr), size(0) {}

    // Th√™m v√†o ƒë·∫ßu danh s√°ch
    void push_front(const T& data) {
        auto new_node = std::make_unique<Node>(data);
        new_node->next = std::move(head);
        head = std::move(new_node);
        size++;
    }

    // X√≥a ph·∫ßn t·ª≠ ƒë·∫ßu
    void pop_front() {
        if (head) {
            head = std::move(head->next);
            size--;
        }
    }

    // Th√™m v√†o cu·ªëi danh s√°ch
    void push_back(const T& data) {
        auto new_node = std::make_unique<Node>(data);

        if (!head) {
            head = std::move(new_node);
        } else {
            Node* current = head.get();
            while (current->next) {
                current = current->next.get();
            }
            current->next = std::move(new_node);
        }
        size++;
    }

    // Hi·ªÉn th·ªã danh s√°ch
    void display() const {
        Node* current = head.get();
        std::cout << "HEAD -> ";
        while (current) {
            std::cout << current->data << " -> ";
            current = current->next.get();
        }
        std::cout << "NULL" << std::endl;
    }

    bool empty() const { return head == nullptr; }
    size_t length() const { return size; }
};`}
                    height="300px"
                  />
                </div>
              )}

              {activeLanguageTab === "python" && (
                <div className="space-y-4">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded">üêç</div>
                    <h5 className="text-lg font-bold text-green-700 dark:text-green-300">LinkedList trong Python</h5>
                  </div>
                  <PythonCodeEditor
                code={`class Node:
    """Node class cho Linked List"""
    def __init__(self, data):
        self.data = data
        self.next = None

class LinkedList:
    """C√†i ƒë·∫∑t Linked List ƒë∆°n gi·∫£n"""

    def __init__(self):
        self.head = None
        self.size = 0

    def push_front(self, data):
        """Th√™m ph·∫ßn t·ª≠ v√†o ƒë·∫ßu danh s√°ch"""
        new_node = Node(data)
        new_node.next = self.head
        self.head = new_node
        self.size += 1

    def pop_front(self):
        """X√≥a v√† tr·∫£ v·ªÅ ph·∫ßn t·ª≠ ƒë·∫ßu"""
        if not self.head:
            return None

        data = self.head.data
        self.head = self.head.next
        self.size -= 1
        return data

    def push_back(self, data):
        """Th√™m ph·∫ßn t·ª≠ v√†o cu·ªëi danh s√°ch"""
        new_node = Node(data)

        if not self.head:
            self.head = new_node
        else:
            current = self.head
            while current.next:
                current = current.next
            current.next = new_node

        self.size += 1

    def pop_back(self):
        """X√≥a v√† tr·∫£ v·ªÅ ph·∫ßn t·ª≠ cu·ªëi"""
        if not self.head:
            return None

        if not self.head.next:
            data = self.head.data
            self.head = None
            self.size -= 1
            return data

        current = self.head
        while current.next.next:
            current = current.next

        data = current.next.data
        current.next = None
        self.size -= 1
        return data

    def display(self):
        """Hi·ªÉn th·ªã danh s√°ch"""
        result = []
        current = self.head

        while current:
            result.append(current.data)
            current = current.next

        return result

    def is_empty(self):
        return self.head is None

    def __len__(self):
        return self.size

# S·ª≠ d·ª•ng:
# ll = LinkedList()
# ll.push_front(1)
# ll.push_back(2)
# print(ll.display())  # [1, 2]`}
                    height="300px"
                  />
                </div>
              )}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}