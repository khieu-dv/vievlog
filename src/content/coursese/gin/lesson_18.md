

# **BÃ i 18: API Documentation vá»›i Swagger**

## ğŸ¯ Má»¥c tiÃªu bÃ i há»c

Sau bÃ i há»c nÃ y, há»c viÃªn sáº½:

* Hiá»ƒu rÃµ **Swagger/OpenAPI** lÃ  gÃ¬ vÃ  vai trÃ² cá»§a nÃ³ trong phÃ¡t triá»ƒn API.
* Biáº¿t cÃ¡ch **táº¡o, quáº£n lÃ½ vÃ  duy trÃ¬ tÃ i liá»‡u API tá»± Ä‘á»™ng** cho á»©ng dá»¥ng Golang Gin.
* Náº¯m Ä‘Æ°á»£c cÃ¡ch sá»­ dá»¥ng **gin-swagger** vÃ  **swaggo/swag** Ä‘á»ƒ táº¡o tÃ i liá»‡u API tÆ°Æ¡ng tÃ¡c.
* Thá»±c hÃ nh viáº¿t **annotation (chÃº thÃ­ch)** cho handler Ä‘á»ƒ sinh tÃ i liá»‡u chuáº©n.
* Hiá»ƒu cÃ¡c **best practices** trong viá»‡c viáº¿t tÃ i liá»‡u API rÃµ rÃ ng, dá»… hiá»ƒu, Ä‘áº§y Ä‘á»§.
* Biáº¿t cÃ¡ch **triá»ƒn khai vÃ  truy cáº­p tÃ i liá»‡u API Swagger** trong dá»± Ã¡n thá»±c táº¿.

## ğŸ“ Ná»™i dung chi tiáº¿t

### 1. Swagger/OpenAPI lÃ  gÃ¬?

* **Swagger** (hiá»‡n nay lÃ  OpenAPI Specification) lÃ  má»™t chuáº©n Ä‘á»‹nh nghÄ©a file JSON/YAML mÃ´ táº£ chi tiáº¿t táº¥t cáº£ endpoints cá»§a API, cÃ¡c request, response, tham sá»‘, Ä‘á»‹nh dáº¡ng dá»¯ liá»‡u, vÃ  cÃ¡c thÃ´ng tin liÃªn quan.
* NÃ³ giÃºp cho **developer vÃ  client dá»… dÃ ng hiá»ƒu, test, vÃ  tÃ­ch há»£p API** mÃ  khÃ´ng cáº§n Ä‘á»c code hay document rá»i ráº¡c.
* Vá»›i Gin, ta cÃ³ thá»ƒ **tá»± Ä‘á»™ng sinh tÃ i liá»‡u Swagger** tá»« code nhá» thÆ° viá»‡n **swaggo/swag**.

### 2. CÃ¡c khÃ¡i niá»‡m quan trá»ng trong Swagger

* **Endpoints/Paths:** ÄÆ°á»ng dáº«n API vÃ  cÃ¡c method HTTP tÆ°Æ¡ng á»©ng (GET, POSTâ€¦).
* **Parameters:** Tham sá»‘ truyá»n vÃ o, cÃ³ thá»ƒ lÃ  path, query, header hoáº·c body.
* **Request Body:** Dá»¯ liá»‡u gá»­i lÃªn (thÆ°á»ng JSON).
* **Response:** Äá»‹nh nghÄ©a cÃ¡c kiá»ƒu dá»¯ liá»‡u vÃ  status code tráº£ vá».
* **Schemas:** CÃ¡c mÃ´ hÃ¬nh dá»¯ liá»‡u (models) Ä‘Æ°á»£c sá»­ dá»¥ng trong request/response.
* **Tags:** NhÃ³m cÃ¡c endpoints theo module chá»©c nÄƒng Ä‘á»ƒ dá»… quáº£n lÃ½.
* **Security:** CÆ¡ cháº¿ báº£o máº­t nhÆ° API Key, OAuth,â€¦

### 3. Giá»›i thiá»‡u thÆ° viá»‡n `swaggo/swag` vÃ  `gin-swagger`

* `swaggo/swag`: DÃ¹ng Ä‘á»ƒ **parse annotation trong code** vÃ  sinh ra file `swagger.json`/`swagger.yaml`.
* `gin-swagger`: Middleware tÃ­ch há»£p Ä‘á»ƒ **render giao diá»‡n Swagger UI** ngay trong á»©ng dá»¥ng Gin.

### 4. CÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh cÆ¡ báº£n

**CÃ¡c bÆ°á»›c thá»±c hiá»‡n:**

```bash
go get -u github.com/swaggo/swag/cmd/swag
go get -u github.com/swaggo/gin-swagger
go get -u github.com/swaggo/files
```

* **Khá»Ÿi táº¡o swag:**

```bash
swag init
```

Lá»‡nh nÃ y sáº½ Ä‘á»c annotation trong code vÃ  táº¡o folder `docs` chá»©a file Swagger.

### 5. Cáº¥u trÃºc annotation trong code (chÃº thÃ­ch)

* Annotation Ä‘áº·t trÃªn pháº§n `handler` hoáº·c `controller` dÆ°á»›i dáº¡ng comment theo cÃº phÃ¡p Ä‘áº·c biá»‡t.
* VÃ­ dá»¥ vá» annotation cho má»™t API:

```go
// @Summary Get user by ID
// @Description Láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng theo ID
// @Tags users
// @Accept json
// @Produce json
// @Param id path int true "User ID"
// @Success 200 {object} models.User
// @Failure 400 {object} utils.HTTPError
// @Router /users/{id} [get]
func (h *UserHandler) GetUser(c *gin.Context) {
    // ...
}
```

**Giáº£i thÃ­ch:**

* `@Summary`: TÃ³m táº¯t ngáº¯n gá»n API
* `@Description`: MÃ´ táº£ chi tiáº¿t hÆ¡n
* `@Tags`: NhÃ³m API theo chá»§ Ä‘á»
* `@Accept`: Äá»‹nh dáº¡ng request
* `@Produce`: Äá»‹nh dáº¡ng response
* `@Param`: Tham sá»‘ truyá»n vÃ o (path/query/body), kÃ¨m loáº¡i vÃ  báº¯t buá»™c hay khÃ´ng
* `@Success`/`@Failure`: MÃ´ táº£ cÃ¡c response vá»›i status code tÆ°Æ¡ng á»©ng vÃ  kiá»ƒu dá»¯ liá»‡u
* `@Router`: ÄÆ°á»ng dáº«n vÃ  method HTTP

### 6. CÃ¡ch tÃ­ch há»£p swagger vÃ o dá»± Ã¡n theo kiáº¿n trÃºc Ä‘á» nghá»‹

**Cáº¥u trÃºc dá»± Ã¡n vÃ­ dá»¥:**

```
â”‚
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ user.go
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ user.go
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ error.go
â”œâ”€â”€ docs/              <-- Folder do `swag init` táº¡o ra
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum
```

**File `cmd/main.go`:**

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/swaggo/gin-swagger"
    swaggerFiles "github.com/swaggo/files"
    _ "your_project/docs" // docs is generated by Swag CLI, you have to import it.

    "your_project/internal/handlers"
)

// @title Example API
// @version 1.0
// @description ÄÃ¢y lÃ  tÃ i liá»‡u API demo vá»›i Swagger vÃ  Gin
// @host localhost:8080
// @BasePath /api/v1

func main() {
    r := gin.Default()

    // Route group api/v1
    v1 := r.Group("/api/v1")
    {
        userHandler := handlers.NewUserHandler()
        v1.GET("/users/:id", userHandler.GetUser)
    }

    // Swagger route
    r.GET("/swagger/*any", ginSwagger.WrapHandler(swaggerFiles.Handler))

    r.Run(":8080")
}
```

### 7. VÃ­ dá»¥ chi tiáº¿t vá»›i handler vÃ  model

**Model `internal/models/user.go`:**

```go
package models

type User struct {
    ID    int    `json:"id" example:"1"`
    Name  string `json:"name" example:"Nguyen Van A"`
    Email string `json:"email" example:"a.nguyen@example.com"`
}
```

**Handler `internal/handlers/user.go`:**

```go
package handlers

import (
    "net/http"
    "strconv"

    "github.com/gin-gonic/gin"
    "your_project/internal/models"
)

type UserHandler struct{}

func NewUserHandler() *UserHandler {
    return &UserHandler{}
}

// @Summary Get user by ID
// @Description Láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng theo ID
// @Tags users
// @Accept json
// @Produce json
// @Param id path int true "User ID"
// @Success 200 {object} models.User
// @Failure 400 {object} map[string]string
// @Failure 404 {object} map[string]string
// @Router /users/{id} [get]
func (h *UserHandler) GetUser(c *gin.Context) {
    idStr := c.Param("id")
    id, err := strconv.Atoi(idStr)
    if err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": "ID pháº£i lÃ  sá»‘ nguyÃªn"})
        return
    }

    // Giáº£ sá»­ dá»¯ liá»‡u tÄ©nh
    if id == 1 {
        user := models.User{
            ID:    1,
            Name:  "Nguyen Van A",
            Email: "a.nguyen@example.com",
        }
        c.JSON(http.StatusOK, user)
        return
    }

    c.JSON(http.StatusNotFound, gin.H{"error": "User khÃ´ng tá»“n táº¡i"})
}
```

### 8. Cháº¡y vÃ  kiá»ƒm tra tÃ i liá»‡u API

* Cháº¡y lá»‡nh `swag init` trong thÆ° má»¥c dá»± Ã¡n Ä‘á»ƒ táº¡o thÆ° má»¥c `docs` vÃ  cÃ¡c file swagger.
* Cháº¡y server: `go run cmd/main.go`
* Truy cáº­p: `http://localhost:8080/swagger/index.html`
* Báº¡n sáº½ tháº¥y giao diá»‡n Swagger UI, cÃ³ thá»ƒ thá»­ gá»­i request trá»±c tiáº¿p táº¡i Ä‘Ã³.

### 9. Best Practices khi viáº¿t Swagger Documentation

* Viáº¿t annotation **Ä‘áº§y Ä‘á»§, rÃµ rÃ ng** cho tá»«ng endpoint, Ä‘áº·c biá»‡t lÃ  mÃ´ táº£ tham sá»‘, request, response.
* Äáº·t tag há»£p lÃ½ Ä‘á»ƒ nhÃ³m API cÃ¹ng tÃ­nh nÄƒng, giÃºp tÃ i liá»‡u dá»… Ä‘á»c.
* LuÃ´n **cáº­p nháº­t tÃ i liá»‡u khi code thay Ä‘á»•i**, trÃ¡nh mismatch.
* Sá»­ dá»¥ng mÃ´ hÃ¬nh (model) chuáº©n cho request vÃ  response Ä‘á»ƒ Swagger sinh schema chÃ­nh xÃ¡c.
* ThÃªm vÃ­ dá»¥ (`example`) trong struct Ä‘á»ƒ Swagger hiá»ƒn thá»‹ dá»¯ liá»‡u máº«u.
* Náº¿u API cÃ³ báº£o máº­t, bá»• sung pháº§n `@Security` annotation vÃ  khai bÃ¡o security schemes.
* TrÃ¡nh viáº¿t annotation quÃ¡ dÃ i dÃ²ng, táº­p trung vÃ o thÃ´ng tin cáº§n thiáº¿t.

## ğŸ† BÃ i táº­p thá»±c hÃ nh cÃ³ lá»i giáº£i chi tiáº¿t

### Äá» bÃ i:

XÃ¢y dá»±ng má»™t API quáº£n lÃ½ sáº£n pháº©m Ä‘Æ¡n giáº£n vá»›i endpoint sau:

* `GET /api/v1/products/:id` â€” Láº¥y thÃ´ng tin sáº£n pháº©m theo ID.

YÃªu cáº§u:

* Viáº¿t model Product gá»“m cÃ¡c trÆ°á»ng: `ID int`, `Name string`, `Price float64`.
* Viáº¿t handler cÃ³ Swagger annotation Ä‘áº§y Ä‘á»§ cho endpoint.
* Triá»ƒn khai tÃ i liá»‡u Swagger hiá»ƒn thá»‹ endpoint nÃ y.
* Tráº£ vá» dá»¯ liá»‡u sáº£n pháº©m giáº£ láº­p vá»›i ID=1, Name="Golang Book", Price=150000.

### Lá»i giáº£i vÃ  phÃ¢n tÃ­ch tá»«ng bÆ°á»›c

**BÆ°á»›c 1: Model sáº£n pháº©m `internal/models/product.go`**

```go
package models

type Product struct {
    ID    int     `json:"id" example:"1"`
    Name  string  `json:"name" example:"Golang Book"`
    Price float64 `json:"price" example:"150000"`
}
```

**BÆ°á»›c 2: Handler `internal/handlers/product.go`**

```go
package handlers

import (
    "net/http"
    "strconv"

    "github.com/gin-gonic/gin"
    "your_project/internal/models"
)

type ProductHandler struct{}

func NewProductHandler() *ProductHandler {
    return &ProductHandler{}
}

// @Summary Get product by ID
// @Description Láº¥y thÃ´ng tin sáº£n pháº©m theo ID
// @Tags products
// @Accept json
// @Produce json
// @Param id path int true "Product ID"
// @Success 200 {object} models.Product
// @Failure 400 {object} map[string]string
// @Failure 404 {object} map[string]string
// @Router /products/{id} [get]
func (h *ProductHandler) GetProduct(c *gin.Context) {
    idStr := c.Param("id")
    id, err := strconv.Atoi(idStr)
    if err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": "ID pháº£i lÃ  sá»‘ nguyÃªn"})
        return
    }

    if id == 1 {
        product := models.Product{
            ID:    1,
            Name:  "Golang Book",
            Price: 150000,
        }
        c.JSON(http.StatusOK, product)
        return
    }

    c.JSON(http.StatusNotFound, gin.H{"error": "Product khÃ´ng tá»“n táº¡i"})
}
```

**BÆ°á»›c 3: ÄÄƒng kÃ½ route trong `cmd/main.go`**

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/swaggo/gin-swagger"
    swaggerFiles "github.com/swaggo/files"
    _ "your_project/docs"
    "your_project/internal/handlers"
)

// @title Product API
// @version 1.0
// @description API quáº£n lÃ½ sáº£n pháº©m demo
// @host localhost:8080
// @BasePath /api/v1
func main() {
    r := gin.Default()

    v1 := r.Group("/api/v1")
    {
        productHandler := handlers.NewProductHandler()
        v1.GET("/products/:id", productHandler.GetProduct)
    }

    r.GET("/swagger/*any", ginSwagger.WrapHandler(swaggerFiles.Handler))

    r.Run(":8080")
}
```

**BÆ°á»›c 4: Khá»Ÿi táº¡o swagger vÃ  cháº¡y á»©ng dá»¥ng**

```bash
swag init
go run cmd/main.go
```

Truy cáº­p `http://localhost:8080/swagger/index.html` Ä‘á»ƒ kiá»ƒm tra tÃ i liá»‡u.

## ğŸ”‘ Nhá»¯ng Ä‘iá»ƒm quan trá»ng cáº§n lÆ°u Ã½

* **LuÃ´n giá»¯ annotation Ä‘á»“ng bá»™ vá»›i code** Ä‘á»ƒ trÃ¡nh tÃ i liá»‡u bá»‹ lá»—i hoáº·c thiáº¿u thÃ´ng tin.
* CÃ¡c annotation pháº£i viáº¿t **theo Ä‘Ãºng cÃº phÃ¡p cá»§a swaggo** Ä‘á»ƒ cÃ´ng cá»¥ parse chÃ­nh xÃ¡c.
* `@Param` pháº£i chá»‰ rÃµ vá»‹ trÃ­ tham sá»‘ (`path`, `query`, `body`, `header`) vÃ  kiá»ƒu dá»¯ liá»‡u.
* Äáº·t **vÃ­ dá»¥ cá»¥ thá»ƒ (example)** trong struct giÃºp tÃ i liá»‡u trá»±c quan hÆ¡n.
* Äá»«ng quÃªn import package `docs` Ä‘Æ°á»£c swag táº¡o ra, náº¿u khÃ´ng Swagger UI sáº½ khÃ´ng hoáº¡t Ä‘á»™ng.
* LuÃ´n thÃªm route cho Swagger UI (`/swagger/*any`) Ä‘á»ƒ dá»… truy cáº­p tÃ i liá»‡u.
* Khi má»Ÿ rá»™ng API, tiáº¿p tá»¥c viáº¿t annotation cho tá»«ng handler má»›i Ä‘á»ƒ giá»¯ tÃ i liá»‡u Ä‘áº§y Ä‘á»§.
* TÃ i liá»‡u Swagger khÃ´ng chá»‰ giÃºp dev mÃ  cÃ²n ráº¥t há»¯u Ã­ch cho tester vÃ  client.

## ğŸ“ BÃ i táº­p vá» nhÃ 

**Äá» bÃ i:**

Má»Ÿ rá»™ng dá»± Ã¡n quáº£n lÃ½ sáº£n pháº©m, táº¡o thÃªm endpoint:

* `POST /api/v1/products` â€” Táº¡o sáº£n pháº©m má»›i.

YÃªu cáº§u:

* Viáº¿t model Product nhÆ° Ä‘Ã£ há»c.
* Viáº¿t handler POST cÃ³ validation dá»¯ liá»‡u (Name khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng, Price pháº£i > 0).
* Viáº¿t annotation Swagger Ä‘áº§y Ä‘á»§ cho endpoint POST nÃ y.
* Triá»ƒn khai tÃ i liá»‡u Swagger vÃ  test thá»­ POST táº¡o sáº£n pháº©m.
* (Bonus) Tráº£ vá» lá»—i chi tiáº¿t náº¿u validation khÃ´ng há»£p lá»‡.


