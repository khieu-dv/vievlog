# B√†i 1: Gi·ªõi thi·ªáu v·ªÅ Bevy v√† WGSL

<div className="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border-l-4 border-blue-500 mb-8">
  <h2 className="text-2xl font-bold text-gray-800 mb-2">üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h2>
  <ul className="list-disc list-inside space-y-2 text-gray-700">
    <li>C√†i ƒë·∫∑t v√† thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng ph√°t tri·ªÉn Bevy (version 0.16+)</li>
    <li>Hi·ªÉu v·ªÅ WebGPU Shading Language (WGSL) v√† s·ª± kh√°c bi·ªát v·ªõi GLSL/HLSL</li>
    <li>T·∫°o project Bevy ƒë·∫ßu ti√™n v·ªõi custom Material v√† shader ƒë∆°n gi·∫£n</li>
    <li>N·∫Øm v·ªØng pipeline rendering c·ªßa Bevy v√† Wgpu backend</li>
  </ul>
</div>

## 1. Gi·ªõi thi·ªáu v·ªÅ Bevy Engine

Bevy l√† m·ªôt game engine hi·ªán ƒë·∫°i ƒë∆∞·ª£c vi·∫øt b·∫±ng Rust, s·ª≠ d·ª•ng Entity Component System (ECS) architecture v√† WebGPU rendering backend. ƒêi·ªÅu n√†y l√†m cho Bevy tr·ªü th√†nh l·ª±a ch·ªçn tuy·ªát v·ªùi ƒë·ªÉ h·ªçc v·ªÅ shader programming.

### 1.1 ∆Øu ƒëi·ªÉm c·ªßa Bevy trong Shader Development

| ƒê·∫∑c ƒëi·ªÉm | L·ª£i √≠ch | So s√°nh v·ªõi Engine kh√°c |
|----------|---------|-------------------------|
| **WebGPU Backend** | API hi·ªán ƒë·∫°i, cross-platform | Unity/Unreal s·ª≠ d·ª•ng API c≈© h∆°n |
| **WGSL Native** | Syntax ƒë∆°n gi·∫£n, d·ªÖ debug | GLSL/HLSL ph·ª©c t·∫°p h∆°n |
| **Hot Reloading** | Shader compile real-time | Y√™u c·∫ßu restart trong nhi·ªÅu engine |
| **Type Safety** | Rust compile-time checking | C++ runtime errors |

### 1.2 WebGPU v√† WGSL Overview

WebGPU l√† API graphics ti·∫ø th·∫ø h·ªá, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ thay th·∫ø OpenGL v√† Direct3D. WGSL (WebGPU Shading Language) l√† shader language ch√≠nh th·ª©c c·ªßa WebGPU.

```mermaid
graph TD
    A[CPU Application] --> B[Bevy Engine]
    B --> C[Wgpu Backend]
    C --> D[WebGPU API]
    D --> E[GPU Hardware]
    
    F[WGSL Shader] --> C
    G[Assets/Textures] --> C
    H[Uniform Data] --> C
    
    style F fill:#e1f5fe
    style C fill:#f3e5f5
    style D fill:#e8f5e8
```

## 2. C√†i ƒë·∫∑t M√¥i tr∆∞·ªùng Ph√°t tri·ªÉn

### 2.1 System Requirements

<div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
  <h4 className="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Y√™u c·∫ßu h·ªá th·ªëng</h4>
  <ul className="text-sm text-yellow-700 space-y-1">
    <li><strong>GPU:</strong> H·ªó tr·ª£ Vulkan/DirectX 12/Metal</li>
    <li><strong>RAM:</strong> 8GB+ (16GB khuy·∫øn ngh·ªã)</li>
    <li><strong>Storage:</strong> 10GB+ cho development environment</li>
    <li><strong>OS:</strong> Windows 10+, macOS 10.15+, Linux</li>
  </ul>
</div>

### 2.2 Installation Steps

**B∆∞·ªõc 1: C√†i ƒë·∫∑t Rust**
```bash
# C√†i ƒë·∫∑t Rust th√¥ng qua rustup
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env

# Ki·ªÉm tra version
rustc --version
cargo --version
```

**B∆∞·ªõc 2: T·∫°o Bevy Project**
```bash
# T·∫°o project m·ªõi
cargo new shader_learning --bin
cd shader_learning

# Th√™m dependencies v√†o Cargo.toml
```

**B∆∞·ªõc 3: C·∫•u h√¨nh Cargo.toml**
```toml
[package]
name = "shader_learning"
version = "0.1.0"
edition = "2021"

[dependencies]
bevy = { version = "0.16", features = ["dynamic_linking"] }

[profile.dev]
opt-level = 1

[profile.dev.package."*"]
opt-level = 3
```

### 2.3 Development Tools Setup

| Tool | M·ª•c ƒë√≠ch | C√†i ƒë·∫∑t |
|------|----------|---------|
| **VS Code** | IDE ch√≠nh | Download t·ª´ code.visualstudio.com |
| **rust-analyzer** | Language Server | Extension trong VS Code |
| **RenderDoc** | Graphics Debugging | renderdoc.org |
| **Cargo Watch** | Auto-rebuild | `cargo install cargo-watch` |

## 3. WGSL vs Other Shading Languages

### 3.1 So s√°nh Syntax

**WGSL (Modern):**
```wgsl
// Vertex Shader
@vertex
fn vs_main(
    @location(0) position: vec3<f32>
) -> @builtin(position) vec4<f32> {
    return vec4<f32>(position, 1.0);
}
```

**GLSL (Legacy):**
```glsl
// Vertex Shader
#version 330 core
layout (location = 0) in vec3 position;

void main() {
    gl_Position = vec4(position, 1.0);
}
```

### 3.2 S·ª± kh√°c bi·ªát ch√≠nh

| Aspect | WGSL | GLSL | HLSL |
|--------|------|------|------|
| **Syntax** | Rust-inspired, modern | C-like, verbose | C-like, Microsoft |
| **Type System** | Strongly typed | Weakly typed | Moderately typed |
| **Error Messages** | Clear, descriptive | Cryptic | Good but Windows-only |
| **Platform Support** | Cross-platform | OpenGL only | DirectX primarily |
| **Future-proof** | Yes (WebGPU standard) | Legacy | Platform-specific |

## 4. Bevy Rendering Pipeline

### 4.1 Render Graph Architecture

```mermaid
graph LR
    A[App World] --> B[Extract Phase]
    B --> C[Prepare Phase]
    C --> D[Queue Phase]
    D --> E[PhaseItem Sort]
    E --> F[Render Phase]
    F --> G[Cleanup Phase]
    
    H[Materials] --> B
    I[Meshes] --> B
    J[Cameras] --> B
    
    style B fill:#ffecb3
    style D fill:#c8e6c9
    style F fill:#ffcdd2
```

### 4.2 Render Phases trong Bevy

| Phase | M·ª•c ƒë√≠ch | Thread | Example Usage |
|-------|----------|--------|---------------|
| **Extract** | Thu th·∫≠p data t·ª´ World | Main | Entity queries, component extraction |
| **Prepare** | Chu·∫©n b·ªã GPU resources | Render | Buffer updates, texture uploads |
| **Queue** | T·∫°o draw calls | Render | Material binding, pipeline setup |
| **Render** | Th·ª±c thi GPU commands | Render | Actual drawing, compute dispatch |

## 5. T·∫°o First Shader Project

### 5.1 Basic Application Setup

```rust
use bevy::prelude::*;

fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_systems(Startup, setup)
        .run();
}

fn setup(
    mut commands: Commands,
    mut meshes: ResMut<Assets<Mesh>>,
    mut materials: ResMut<Assets<StandardMaterial>>,
) {
    // Camera
    commands.spawn(Camera3dBundle {
        transform: Transform::from_xyz(0.0, 0.0, 5.0)
            .looking_at(Vec3::ZERO, Vec3::Y),
        ..default()
    });
    
    // Light
    commands.spawn(PointLightBundle {
        transform: Transform::from_xyz(4.0, 5.0, 4.0),
        ..default()
    });
    
    // Cube v·ªõi material m·∫∑c ƒë·ªãnh
    commands.spawn(PbrBundle {
        mesh: meshes.add(Mesh::from(Cuboid::new(2.0, 2.0, 2.0))),
        material: materials.add(StandardMaterial {
            base_color: Color::BLUE,
            ..default()
        }),
        ..default()
    });
}
```

### 5.2 Custom Material Implementation

```rust
use bevy::{
    pbr::{Material, MaterialPlugin},
    render::render_resource::{AsBindGroup, ShaderRef},
};

#[derive(Asset, TypePath, AsBindGroup, Debug, Clone)]
pub struct CustomMaterial {
    #[uniform(0)]
    pub color: Vec4,
    #[uniform(0)]
    pub time: f32,
}

impl Material for CustomMaterial {
    fn fragment_shader() -> ShaderRef {
        "shaders/custom_material.wgsl".into()
    }
}

// Trong main function
fn main() {
    App::new()
        .add_plugins((
            DefaultPlugins,
            MaterialPlugin::<CustomMaterial>::default(),
        ))
        .add_systems(Startup, setup)
        .add_systems(Update, update_material)
        .run();
}
```

### 5.3 First WGSL Shader

T·∫°o file `assets/shaders/custom_material.wgsl`:

```wgsl
#import bevy_pbr::forward_io::VertexOutput

struct CustomMaterial {
    color: vec4<f32>,
    time: f32,
};

@group(2) @binding(0)
var<uniform> material: CustomMaterial;

@fragment
fn fragment(
    mesh: VertexOutput,
) -> @location(0) vec4<f32> {
    // T·∫°o hi·ªáu ·ª©ng color cycling
    let time_factor = sin(material.time) * 0.5 + 0.5;
    let animated_color = material.color * time_factor;
    
    return vec4<f32>(animated_color.rgb, 1.0);
}
```

## 6. Debug Tools v√† Troubleshooting

### 6.1 Common Shader Errors

<div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
  <h4 className="font-semibold text-red-800 mb-2">üö´ L·ªói th∆∞·ªùng g·∫∑p</h4>
  <div className="text-sm text-red-700 space-y-2">
    <div><strong>Compilation Error:</strong> Syntax sai trong WGSL</div>
    <div><strong>Binding Error:</strong> Uniform binding kh√¥ng ƒë√∫ng</div>
    <div><strong>Type Mismatch:</strong> Ki·ªÉu d·ªØ li·ªáu kh√¥ng kh·ªõp</div>
    <div><strong>Resource Error:</strong> Texture ho·∫∑c buffer kh√¥ng t·ªìn t·∫°i</div>
  </div>
</div>

### 6.2 Debugging Techniques

| Technique | Usage | Example |
|-----------|-------|---------|
| **Console Logs** | Rust-side debugging | `println!("Material: {:?}", material)` |
| **Shader Validation** | WGSL compile errors | Check terminal output |
| **RenderDoc** | GPU frame debugging | Capture frame, inspect draw calls |
| **Hot Reloading** | Live shader editing | Modify .wgsl files without restart |

### 6.3 Performance Monitoring

```rust
// Th√™m FPS counter
use bevy::diagnostic::{DiagnosticsStore, FrameTimeDiagnosticsPlugin};

fn main() {
    App::new()
        .add_plugins((
            DefaultPlugins,
            FrameTimeDiagnosticsPlugin::default(),
        ))
        .add_systems(Update, fps_counter_system)
        .run();
}

fn fps_counter_system(diagnostics: Res<DiagnosticsStore>) {
    if let Some(fps) = diagnostics.get(&FrameTimeDiagnosticsPlugin::FPS) {
        if let Some(value) = fps.smoothed() {
            println!("FPS: {:.2}", value);
        }
    }
}
```

## 7. B√†i t·∫≠p th·ª±c h√†nh

### 7.1 Exercise 1: Color Animation

**M·ª•c ti√™u:** T·∫°o m·ªôt cube thay ƒë·ªïi m√†u theo th·ªùi gian

**Y√™u c·∫ßu:**
- S·ª≠ d·ª•ng CustomMaterial
- Implement color transition: Red ‚Üí Green ‚Üí Blue ‚Üí Red
- Chu k·ª≥ 3 gi√¢y

**G·ª£i √Ω:**
```wgsl
// Trong fragment shader
let cycle = (material.time % 3.0) / 3.0;
let r = sin(cycle * 6.28318) * 0.5 + 0.5;
let g = sin((cycle + 0.33) * 6.28318) * 0.5 + 0.5;
let b = sin((cycle + 0.66) * 6.28318) * 0.5 + 0.5;
```

### 7.2 Exercise 2: Multiple Materials

**M·ª•c ti√™u:** T·∫°o nhi·ªÅu objects v·ªõi materials kh√°c nhau

**Y√™u c·∫ßu:**
- 3 cubes v·ªõi 3 materials kh√°c nhau
- M·ªói material c√≥ t·ªëc ƒë·ªô animation kh√°c nhau
- S·∫Øp x·∫øp th√†nh h√†ng ngang

## 8. T√†i li·ªáu tham kh·∫£o

### 8.1 Official Documentation

| Resource | URL | M√¥ t·∫£ |
|----------|-----|--------|
| **Bevy Book** | bevyengine.org/learn/book | H∆∞·ªõng d·∫´n ch√≠nh th·ª©c |
| **WGSL Spec** | w3.org/TR/WGSL | WebGPU Shading Language specification |
| **Wgpu Guide** | sotrh.github.io/learn-wgpu | WebGPU programming guide |

### 8.2 Community Resources

<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  <div className="bg-green-50 p-4 rounded-lg">
    <h4 className="font-bold text-green-800 mb-2">üåü Learning Resources</h4>
    <ul className="text-sm text-green-700 space-y-1">
      <li>Bevy Discord Community</li>
      <li>r/rust_gamedev Reddit</li>
      <li>Bevy Assets Collection</li>
      <li>Shader examples on GitHub</li>
    </ul>
  </div>
  
  <div className="bg-purple-50 p-4 rounded-lg">
    <h4 className="font-bold text-purple-800 mb-2">üîß Tools & Extensions</h4>
    <ul className="text-sm text-purple-700 space-y-1">
      <li>VS Code WGSL extension</li>
      <li>Bevy Inspector Egui</li>
      <li>Cargo expand for macro debugging</li>
      <li>RenderDoc integration</li>
    </ul>
  </div>
</div>

## 9. T√≥m t·∫Øt v√† Chu·∫©n b·ªã cho B√†i 2

### 9.1 Ki·∫øn th·ª©c ƒë√£ h·ªçc

<div className="bg-blue-50 p-6 rounded-lg">
  <h4 className="font-bold text-blue-800 mb-3">‚úÖ Checklist ki·∫øn th·ª©c</h4>
  <div className="grid grid-cols-2 gap-4 text-sm">
    <div>
      <p className="font-semibold mb-2">Setup & Environment:</p>
      <ul className="space-y-1 text-blue-700">
        <li>‚òëÔ∏è Rust v√† Cargo installation</li>
        <li>‚òëÔ∏è Bevy project setup</li>
        <li>‚òëÔ∏è Development tools</li>
      </ul>
    </div>
    <div>
      <p className="font-semibold mb-2">Shader Concepts:</p>
      <ul className="space-y-1 text-blue-700">
        <li>‚òëÔ∏è WGSL vs GLSL differences</li>
        <li>‚òëÔ∏è Custom Material creation</li>
        <li>‚òëÔ∏è Basic fragment shader</li>
      </ul>
    </div>
  </div>
</div>

### 9.2 Preview B√†i 2

**B√†i 2: C·∫•u tr√∫c c∆° b·∫£n c·ªßa WGSL shader** s·∫Ω t·∫≠p trung v√†o:
- WGSL syntax chi ti·∫øt
- Vertex shader programming  
- Data types v√† functions
- Input/Output handling
- Debug techniques n√¢ng cao

---

<div className="mt-8 p-4 bg-gray-100 rounded-lg text-center">
  <p className="text-gray-600 text-sm">
    <strong>L∆∞u √Ω:</strong> H√£y ƒë·∫£m b·∫£o ho√†n th√†nh t·∫•t c·∫£ exercises tr∆∞·ªõc khi chuy·ªÉn sang b√†i ti·∫øp theo. 
    N·∫øu g·∫∑p v·∫•n ƒë·ªÅ, tham khao ph·∫ßn troubleshooting ho·∫∑c c·ªông ƒë·ªìng Bevy Discord.
  </p>
</div>