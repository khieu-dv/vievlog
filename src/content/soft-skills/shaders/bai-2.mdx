# B√†i 2: C·∫•u tr√∫c c∆° b·∫£n c·ªßa WGSL shader

<div className="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border-l-4 border-blue-500 mb-8">
  <h2 className="text-2xl font-bold text-gray-800 mb-2">üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h2>
  <ul className="list-disc list-inside space-y-2 text-gray-700">
    <li>N·∫Øm v·ªØng syntax c∆° b·∫£n c·ªßa WGSL (variables, functions, types)</li>
    <li>Hi·ªÉu r√µ v·ªÅ vertex input v√† fragment output trong pipeline rendering</li>
    <li>T·∫°o ƒë∆∞·ª£c vertex shader ƒë∆°n gi·∫£n ƒë·ªÉ v·∫Ω h√¨nh tam gi√°c</li>
    <li>L√†m vi·ªác th√†nh th·∫°o v·ªõi c√°c ki·ªÉu d·ªØ li·ªáu: vec2, vec3, vec4, mat4</li>
    <li>T·∫°o fragment shader ƒë·ªÉ t√¥ m√†u c∆° b·∫£n</li>
    <li>Debug v√† kh·∫Øc ph·ª•c l·ªói shader hi·ªáu qu·∫£</li>
  </ul>
</div>

## üìö L√Ω thuy·∫øt c∆° b·∫£n

### 1. WebGPU Shading Language (WGSL) l√† g√¨?

**WGSL** l√† ng√¥n ng·ªØ shader ch√≠nh th·ª©c c·ªßa WebGPU, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ:
- Ch·∫°y native tr√™n m·ªçi platform (Windows, macOS, Linux, Web)
- Cung c·∫•p syntax hi·ªán ƒë·∫°i v√† type-safe
- T·ªëi ∆∞u h√≥a hi·ªáu su·∫•t cho GPU hi·ªán ƒë·∫°i

### 2. So s√°nh WGSL v·ªõi c√°c ng√¥n ng·ªØ shader kh√°c

| ƒê·∫∑c ƒëi·ªÉm | WGSL | GLSL | HLSL |
|----------|------|------|------|
| **Platform** | Cross-platform | OpenGL/Vulkan | DirectX |
| **Type System** | Strict typing | Loose typing | Medium typing |
| **Syntax** | Rust-like | C-like | C++-like |
| **Memory Model** | Explicit | Implicit | Mixed |
| **Precision** | Explicit | Varying | Explicit |

## üèóÔ∏è C·∫•u tr√∫c Rendering Pipeline

```mermaid
graph TD
    A[Vertex Data] --> B[Vertex Shader]
    B --> C[Rasterization]
    C --> D[Fragment Shader]
    D --> E[Color Output]
    
    F[Uniforms] --> B
    F --> D
    G[Textures] --> D
    
    style B fill:#e1f5fe
    style D fill:#f3e5f5
    style C fill:#e8f5e8
```

<div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 my-6">
  <div className="flex">
    <div className="flex-shrink-0">
      <svg className="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
        <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
      </svg>
    </div>
    <div className="ml-3">
      <p className="text-sm text-yellow-700">
        <strong>L∆∞u √Ω quan tr·ªçng:</strong> Vertex Shader x·ª≠ l√Ω t·ª´ng vertex ri√™ng bi·ªát, trong khi Fragment Shader x·ª≠ l√Ω t·ª´ng pixel ƒë∆∞·ª£c rasterize.
      </p>
    </div>
  </div>
</div>

## üîß C·∫•u tr√∫c c∆° b·∫£n c·ªßa WGSL Shader

### 1. Ki·ªÉu d·ªØ li·ªáu c∆° b·∫£n

| Ki·ªÉu d·ªØ li·ªáu | M√¥ t·∫£ | V√≠ d·ª• s·ª≠ d·ª•ng |
|--------------|--------|---------------|
| `f32` | S·ªë th·ª±c 32-bit | `var position: f32 = 1.5;` |
| `i32` | S·ªë nguy√™n 32-bit c√≥ d·∫•u | `var count: i32 = 10;` |
| `u32` | S·ªë nguy√™n 32-bit kh√¥ng d·∫•u | `var index: u32 = 0u;` |
| `bool` | Boolean | `var is_visible: bool = true;` |
| `vec2<f32>` | Vector 2D | `var uv: vec2<f32> = vec2(0.5, 0.5);` |
| `vec3<f32>` | Vector 3D | `var color: vec3<f32> = vec3(1.0, 0.0, 0.0);` |
| `vec4<f32>` | Vector 4D | `var position: vec4<f32> = vec4(0.0, 0.0, 0.0, 1.0);` |
| `mat4x4<f32>` | Ma tr·∫≠n 4x4 | `var transform: mat4x4<f32>;` |

### 2. C·∫•u tr√∫c Vertex Input v√† Output

```wgsl
// Vertex Input Structure
struct VertexInput {
    @location(0) position: vec3<f32>,    // V·ªã tr√≠ vertex
    @location(1) color: vec3<f32>,       // M√†u s·∫Øc vertex
    @location(2) uv: vec2<f32>,          // T·ªça ƒë·ªô texture
}

// Vertex Output Structure  
struct VertexOutput {
    @builtin(position) position: vec4<f32>,  // V·ªã tr√≠ trong clip space
    @location(0) color: vec3<f32>,           // M√†u s·∫Øc interpolated
    @location(1) uv: vec2<f32>,              // UV coordinates
}
```

## üí° T·∫°o Vertex Shader ƒë·∫ßu ti√™n

<div className="bg-blue-50 p-6 rounded-lg mb-6">
  <h3 className="text-lg font-semibold text-blue-800 mb-3">üöÄ Th·ª±c h√†nh: Vertex Shader c∆° b·∫£n</h3>

### B∆∞·ªõc 1: T·∫°o Vertex Shader v·∫Ω tam gi√°c

```wgsl
// vertex_shader.wgsl
struct VertexInput {
    @location(0) position: vec3<f32>,
    @location(1) color: vec3<f32>,
}

struct VertexOutput {
    @builtin(position) clip_position: vec4<f32>,
    @location(0) color: vec3<f32>,
}

@vertex
fn vs_main(vertex: VertexInput) -> VertexOutput {
    var output: VertexOutput;
    
    // Chuy·ªÉn ƒë·ªïi position t·ª´ 3D sang clip space 4D
    output.clip_position = vec4<f32>(vertex.position, 1.0);
    
    // Truy·ªÅn m√†u s·∫Øc xu·ªëng fragment shader
    output.color = vertex.color;
    
    return output;
}
```

### B∆∞·ªõc 2: T·∫°o Fragment Shader

```wgsl
// fragment_shader.wgsl
struct FragmentInput {
    @location(0) color: vec3<f32>,
}

@fragment  
fn fs_main(input: FragmentInput) -> @location(0) vec4<f32> {
    // Tr·∫£ v·ªÅ m√†u s·∫Øc v·ªõi alpha = 1.0 (kh√¥ng trong su·ªët)
    return vec4<f32>(input.color, 1.0);
}
```

</div>

## üé® T√≠ch h·ª£p v·ªõi Bevy Engine

### 1. T·∫°o Custom Material trong Bevy

```rust
// src/triangle_material.rs
use bevy::{
    prelude::*,
    reflect::TypeUuid,
    render::render_resource::*,
};

#[derive(AsBindGroup, TypeUuid, Debug, Clone)]
#[uuid = "f690fdae-d598-45ab-8225-97e2a3f056e0"]
pub struct TriangleMaterial {
    #[uniform(0)]
    pub base_color: Color,
}

impl Material for TriangleMaterial {
    fn vertex_shader() -> ShaderRef {
        "shaders/triangle_vertex.wgsl".into()
    }

    fn fragment_shader() -> ShaderRef {
        "shaders/triangle_fragment.wgsl".into()
    }
}
```

### 2. Setup Bevy App

```rust
// src/main.rs
use bevy::{prelude::*, render::mesh::Indices};

fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_plugin(MaterialPlugin::<TriangleMaterial>::default())
        .add_startup_system(setup)
        .run();
}

fn setup(
    mut commands: Commands,
    mut meshes: ResMut<Assets<Mesh>>,
    mut materials: ResMut<Assets<TriangleMaterial>>,
) {
    // T·∫°o mesh tam gi√°c
    let triangle_mesh = create_triangle_mesh();
    
    // Spawn entity v·ªõi triangle mesh
    commands.spawn(MaterialMeshBundle {
        mesh: meshes.add(triangle_mesh),
        material: materials.add(TriangleMaterial {
            base_color: Color::RED,
        }),
        ..default()
    });
    
    // Camera
    commands.spawn(Camera3dBundle {
        transform: Transform::from_xyz(0.0, 0.0, 5.0),
        ..default()
    });
}

fn create_triangle_mesh() -> Mesh {
    let vertices = vec![
        // Position        // Color
        [0.0, 0.5, 0.0],   [1.0, 0.0, 0.0], // ƒê·ªânh tr√™n - ƒë·ªè
        [-0.5, -0.5, 0.0], [0.0, 1.0, 0.0], // ƒê·ªânh tr√°i - xanh l√°
        [0.5, -0.5, 0.0],  [0.0, 0.0, 1.0], // ƒê·ªânh ph·∫£i - xanh d∆∞∆°ng
    ];
    
    let indices = vec![0, 1, 2]; // Th·ª© t·ª± vertices
    
    let mut mesh = Mesh::new(PrimitiveTopology::TriangleList);
    
    // T√°ch positions v√† colors
    let positions: Vec<[f32; 3]> = vertices.iter()
        .map(|v| [v[0], v[1], v[2]]).collect();
    let colors: Vec<[f32; 3]> = vertices.iter()
        .map(|v| [v[3], v[4], v[5]]).collect();
    
    mesh.insert_attribute(Mesh::ATTRIBUTE_POSITION, positions);
    mesh.insert_attribute(Mesh::ATTRIBUTE_COLOR, colors);
    mesh.set_indices(Some(Indices::U32(indices)));
    
    mesh
}
```

## üîç Debug v√† Troubleshooting

### C√°c l·ªói th∆∞·ªùng g·∫∑p v√† c√°ch kh·∫Øc ph·ª•c

<div className="overflow-x-auto">
  <table className="w-full border-collapse border border-gray-300 bg-white">
    <thead className="bg-gray-50">
      <tr>
        <th className="border border-gray-300 px-4 py-2 text-left font-medium text-gray-700">L·ªói</th>
        <th className="border border-gray-300 px-4 py-2 text-left font-medium text-gray-700">Nguy√™n nh√¢n</th>
        <th className="border border-gray-300 px-4 py-2 text-left font-medium text-gray-700">Gi·∫£i ph√°p</th>
      </tr>
    </thead>
    <tbody>
      <tr className="hover:bg-gray-50">
        <td className="border border-gray-300 px-4 py-2 font-mono text-sm">Shader compilation error</td>
        <td className="border border-gray-300 px-4 py-2">Syntax sai trong WGSL</td>
        <td className="border border-gray-300 px-4 py-2">Ki·ªÉm tra syntax, missing semicolons</td>
      </tr>
      <tr className="hover:bg-gray-50">
        <td className="border border-gray-300 px-4 py-2 font-mono text-sm">Binding mismatch</td>
        <td className="border border-gray-300 px-4 py-2">@location kh√¥ng kh·ªõp</td>
        <td className="border border-gray-300 px-4 py-2">ƒê·∫£m b·∫£o vertex output = fragment input</td>
      </tr>
      <tr className="hover:bg-gray-50">
        <td className="border border-gray-300 px-4 py-2 font-mono text-sm">Black screen</td>
        <td className="border border-gray-300 px-4 py-2">Vertices ngo√†i clip space</td>
        <td className="border border-gray-300 px-4 py-2">Ki·ªÉm tra position values [-1, 1] range</td>
      </tr>
      <tr className="hover:bg-gray-50">
        <td className="border border-gray-300 px-4 py-2 font-mono text-sm">Wrong colors</td>
        <td className="border border-gray-300 px-4 py-2">Color range kh√¥ng ƒë√∫ng</td>
        <td className="border border-gray-300 px-4 py-2">S·ª≠ d·ª•ng [0.0, 1.0] cho m√†u s·∫Øc</td>
      </tr>
    </tbody>
  </table>
</div>

### Tools Debug h·ªØu √≠ch

```mermaid
graph LR
    A[Debug Tools] --> B[RenderDoc]
    A --> C[Bevy Inspector]
    A --> D[Console Logs]
    A --> E[Shader Validator]
    
    B --> F[Frame Capture]
    B --> G[Shader Analysis]
    
    C --> H[Real-time Material Editor]
    C --> I[Component Inspector]
    
    style A fill:#f9f9f9
    style B fill:#e3f2fd
    style C fill:#e8f5e8
```

## üèãÔ∏è B√†i t·∫≠p th·ª±c h√†nh

<div className="bg-green-50 border-l-4 border-green-400 p-6 my-6">
  <h3 className="text-lg font-semibold text-green-800 mb-3">üí™ Th·ª≠ th√°ch</h3>
  
### B√†i t·∫≠p 1: T·∫°o h√¨nh vu√¥ng c√≥ m√†u gradient

**Y√™u c·∫ßu:**
- T·∫°o mesh h√¨nh vu√¥ng v·ªõi 4 vertices
- M·ªói g√≥c c√≥ m√†u s·∫Øc kh√°c nhau
- S·ª≠ d·ª•ng indices ƒë·ªÉ t·∫°o 2 tam gi√°c

### B√†i t·∫≠p 2: Animation ƒë∆°n gi·∫£n

**Y√™u c·∫ßu:**
- Th√™m uniform `time` v√†o shader
- T·∫°o hi·ªáu ·ª©ng xoay tam gi√°c
- Thay ƒë·ªïi m√†u s·∫Øc theo th·ªùi gian

### B√†i t·∫≠p 3: Multiple shapes

**Y√™u c·∫ßu:**
- T·∫°o nhi·ªÅu h√¨nh d·∫°ng kh√°c nhau
- S·ª≠ d·ª•ng c√πng m·ªôt shader
- √Åp d·ª•ng transforms kh√°c nhau

</div>

## üéì T√≥m t·∫Øt ki·∫øn th·ª©c

### Checklist ki·∫øn th·ª©c c·∫ßn n·∫Øm v·ªØng:

- [ ] **Syntax WGSL c∆° b·∫£n**: Variables, functions, structs
- [ ] **Ki·ªÉu d·ªØ li·ªáu**: vec2, vec3, vec4, mat4x4
- [ ] **Vertex Input/Output**: @location, @builtin attributes  
- [ ] **Vertex Shader**: X·ª≠ l√Ω position v√† attributes
- [ ] **Fragment Shader**: T·∫°o m√†u s·∫Øc cho pixels
- [ ] **Bevy Integration**: Material trait, mesh creation
- [ ] **Debug Skills**: Troubleshooting v√† error fixing

### ƒêi·ªÉm chu·∫©n ƒë√°nh gi√°:

| M·ª©c ƒë·ªô | M√¥ t·∫£ | Ti√™u ch√≠ |
|--------|-------|----------|
| **C∆° b·∫£n** | Hi·ªÉu syntax WGSL | T·∫°o ƒë∆∞·ª£c shader ƒë∆°n gi·∫£n kh√¥ng l·ªói |
| **Trung b√¨nh** | T√≠ch h·ª£p Bevy th√†nh c√¥ng | Render ƒë∆∞·ª£c h√¨nh tam gi√°c v·ªõi m√†u |
| **Kh√°** | Custom materials | T·∫°o ƒë∆∞·ª£c nhi·ªÅu shapes kh√°c nhau |
| **Gi·ªèi** | Animation c∆° b·∫£n | Th√™m ƒë∆∞·ª£c movement v√† color animation |

---

<div className="bg-blue-100 border border-blue-300 rounded-lg p-6 mt-8">
  <h3 className="text-xl font-bold text-blue-800 mb-3">üìã Chu·∫©n b·ªã cho B√†i 3</h3>
  <p className="text-blue-700 mb-4">
    Trong b√†i h·ªçc ti·∫øp theo, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ <strong>Uniforms v√† Bindings trong Bevy</strong> - c√°ch truy·ªÅn d·ªØ li·ªáu t·ª´ CPU sang GPU m·ªôt c√°ch hi·ªáu qu·∫£.
  </p>
  
  <h4 className="font-semibold text-blue-800 mb-2">Ki·∫øn th·ª©c c·∫ßn √¥n t·∫≠p:</h4>
  <ul className="list-disc list-inside text-blue-700 space-y-1">
    <li>C√°ch t·∫°o struct trong WGSL</li>
    <li>Hi·ªÉu v·ªÅ binding trong GPU programming</li>
    <li>Bevy Material trait v√† custom properties</li>
    <li>Rust ownership v√† borrowing (ƒë·ªÉ hi·ªÉu uniform buffers)</li>
  </ul>
  
  <div className="mt-4 p-3 bg-blue-50 rounded">
    <p className="text-sm text-blue-600">
      <strong>üí° Tip:</strong> Th·ª±c h√†nh t·∫°o th√™m nhi·ªÅu shapes v√† th·ª≠ nghi·ªám v·ªõi c√°c m√†u s·∫Øc kh√°c nhau ƒë·ªÉ l√†m quen v·ªõi vertex attributes!
    </p>
  </div>
</div>