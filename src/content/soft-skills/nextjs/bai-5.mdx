# BÃ i 5: Next.js App Router - Routing Basics

<div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r-lg">
  <h2 className="text-2xl font-bold text-blue-800 mb-2">ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2>
  <p className="text-gray-700">Náº¯m vá»¯ng cÆ¡ cháº¿ Ä‘á»‹nh tuyáº¿n (routing) trong Next.js App Router, hiá»ƒu Ä‘Æ°á»£c sá»± khÃ¡c biá»‡t vá»›i Pages Router vÃ  thá»±c hÃ nh xÃ¢y dá»±ng cáº¥u trÃºc routing cho má»™t á»©ng dá»¥ng thá»±c táº¿.</p>
</div>

## ğŸ“š Tá»•ng quan vá» App Router

### So sÃ¡nh Pages Router vs App Router

```mermaid
graph TB
    A[Next.js Routing Systems] --> B[Pages Router]
    A --> C[App Router]
    
    B --> D[ğŸ“ pages/]
    B --> E[ğŸ”§ Next.js 12 vÃ  trÆ°á»›c]
    B --> F[ğŸ“„ File = Route]
    
    C --> G[ğŸ“ app/]
    C --> H[ğŸ”§ Next.js 13+]
    C --> I[ğŸ“‚ Folder = Route]
```

<div className="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
  <div className="border rounded-lg p-4 hover:shadow-md transition-shadow">
    <h3 className="font-semibold text-red-600 mb-2">Pages Router (Legacy)</h3>
    <ul className="text-sm space-y-1">
      <li>â€¢ File-based routing trong thÆ° má»¥c pages/</li>
      <li>â€¢ Má»—i file .js/.ts = má»™t route</li>
      <li>â€¢ Sá»­ dá»¥ng _app.js vÃ  _document.js</li>
      <li>â€¢ API routes trong pages/api/</li>
    </ul>
  </div>
  <div className="border rounded-lg p-4 hover:shadow-md transition-shadow border-green-300">
    <h3 className="font-semibold text-green-600 mb-2">App Router (Khuyáº¿n khÃ­ch)</h3>
    <ul className="text-sm space-y-1">
      <li>â€¢ Folder-based routing trong thÆ° má»¥c app/</li>
      <li>â€¢ Má»—i thÆ° má»¥c = má»™t route segment</li>
      <li>â€¢ Sá»­ dá»¥ng layout.js vÃ  page.js</li>
      <li>â€¢ Server Components máº·c Ä‘á»‹nh</li>
    </ul>
  </div>
</div>

## ğŸ—ºï¸ Routing Terminology

| Thuáº­t ngá»¯ | Äá»‹nh nghÄ©a | VÃ­ dá»¥ |
|-----------|------------|-------|
| **Route** | Má»™t Ä‘Æ°á»ng dáº«n URL hoÃ n chá»‰nh | `/products/shoes` |
| **Segment** | Má»™t pháº§n cá»§a route Ä‘Æ°á»£c phÃ¢n tÃ¡ch bá»Ÿi `/` | `products`, `shoes` |
| **Nested Routes** | Routes lá»“ng nhau theo cáº¥u trÃºc thÆ° má»¥c | `/blog/category/post` |
| **Dynamic Routes** | Routes vá»›i tham sá»‘ Ä‘á»™ng | `/products/[id]` |
| **Route Groups** | NhÃ³m routes khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n URL | `(marketing)/about` |

## ğŸ“ Cáº¥u trÃºc File-based Routing

<div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400 mb-4">
  <p className="text-sm text-blue-700"><strong>ğŸ’¡ File-based Routing lÃ  gÃ¬?</strong></p>
  <p className="text-sm text-blue-700 mt-2">LÃ  há»‡ thá»‘ng Ä‘á»‹nh tuyáº¿n dá»±a trÃªn cáº¥u trÃºc thÆ° má»¥c vÃ  file. Trong App Router, má»—i thÆ° má»¥c tÆ°Æ¡ng á»©ng vá»›i má»™t route segment, vÃ  file <code>page.tsx</code> Ä‘á»‹nh nghÄ©a UI cho route Ä‘Ã³.</p>
</div>

### Cáº¥u trÃºc cÆ¡ báº£n

```typescript
app/
â”œâ”€â”€ layout.tsx          // Root layout
â”œâ”€â”€ page.tsx           // Home page (/)
â”œâ”€â”€ loading.tsx        // Loading UI
â”œâ”€â”€ error.tsx          // Error UI
â”œâ”€â”€ not-found.tsx      // 404 page
â”œâ”€â”€ about/
â”‚   â””â”€â”€ page.tsx       // /about
â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ layout.tsx     // Products layout
â”‚   â”œâ”€â”€ page.tsx       // /products
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ page.tsx   // /products/[id]
â””â”€â”€ blog/
    â”œâ”€â”€ page.tsx       // /blog
    â””â”€â”€ [...slug]/
        â””â”€â”€ page.tsx   // /blog/[...slug]
```

### Mapping thÆ° má»¥c sang Routes

```mermaid
graph LR
    A[app] --> B[homepage]
    A --> C[about]
    A --> D[products]
    C --> E[aboutpage]
    D --> F[productspage]
    D --> G[shoes]
    D --> H[productid]
```

## ğŸ—ï¸ Táº¡o Routes cÆ¡ báº£n

### 1. Static Routes

<div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-400 mb-4">
  <p className="text-sm text-green-700"><strong>ğŸ’¡ Static Routes lÃ  gÃ¬?</strong></p>
  <p className="text-sm text-green-700 mt-2">Routes cÃ³ Ä‘Æ°á»ng dáº«n cá»‘ Ä‘á»‹nh, khÃ´ng thay Ä‘á»•i. VÃ­ dá»¥ <code>/about</code>, <code>/contact</code>. ChÃºng Ä‘Æ°á»£c táº¡o báº±ng cÃ¡ch táº¡o thÆ° má»¥c vá»›i tÃªn cá»‘ Ä‘á»‹nh vÃ  file <code>page.tsx</code> bÃªn trong.</p>
</div>

<div className="bg-gray-50 p-4 rounded-lg border-l-4 border-gray-400 mb-4">
  <h4 className="font-medium mb-2">ğŸ“ VÃ­ dá»¥: Táº¡o trang About</h4>
</div>

```typescript
// app/about/page.tsx
export default function AboutPage() {
  return (
    <div className="max-w-4xl mx-auto py-8 px-4">
      <h1 className="text-3xl font-bold mb-4">Vá» chÃºng tÃ´i</h1>
      <p className="text-gray-600">
        ÄÃ¢y lÃ  trang giá»›i thiá»‡u vá» cÃ´ng ty chÃºng tÃ´i.
      </p>
    </div>
  )
}
```

### 2. Nested Routes

<div className="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-400 mb-4">
  <p className="text-sm text-purple-700"><strong>ğŸ’¡ Nested Routes lÃ  gÃ¬?</strong></p>
  <p className="text-sm text-purple-700 mt-2">Routes lá»“ng nhau theo cáº¥u trÃºc thÆ° má»¥c. VÃ­ dá»¥ <code>/products/shoes</code> cÃ³ nghÄ©a lÃ  thÆ° má»¥c <code>shoes</code> náº±m bÃªn trong thÆ° má»¥c <code>products</code>. Nested routes cho phÃ©p táº¡o layout hierarchy vÃ  shared components.</p>
</div>

```typescript
// app/products/shoes/page.tsx
export default function ShoesPage() {
  return (
    <div>
      <h1>Danh sÃ¡ch giÃ y</h1>
      <p>CÃ¡c sáº£n pháº©m giÃ y dÃ©p</p>
    </div>
  )
}

// app/products/clothes/page.tsx
export default function ClothesPage() {
  return (
    <div>
      <h1>Danh sÃ¡ch quáº§n Ã¡o</h1>
      <p>CÃ¡c sáº£n pháº©m thá»i trang</p>
    </div>
  )
}
```

## ğŸ”„ Dynamic Routing

<div className="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-400 mb-4">
  <p className="text-sm text-orange-700"><strong>ğŸ’¡ Dynamic Routing lÃ  gÃ¬?</strong></p>
  <p className="text-sm text-orange-700 mt-2">Cho phÃ©p táº¡o routes vá»›i tham sá»‘ Ä‘á»™ng thay vÃ¬ Ä‘Æ°á»ng dáº«n cá»‘ Ä‘á»‹nh. Sá»­ dá»¥ng dáº¥u ngoáº·c vuÃ´ng <code>[param]</code> Ä‘á»ƒ táº¡o dynamic segments. VÃ­ dá»¥ <code>[id]</code> cÃ³ thá»ƒ match <code>/products/1</code>, <code>/products/abc</code>, etc.</p>
</div>

### Single Dynamic Segment `[id]`

<div className="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400 mb-4">
  <p className="text-sm text-yellow-700"><strong>ğŸ’¡ Single Dynamic Segment:</strong> Má»™t tham sá»‘ Ä‘á»™ng duy nháº¥t trong route. File/thÆ° má»¥c Ä‘Æ°á»£c Ä‘áº·t tÃªn trong dáº¥u <code>[]</code>. GiÃ¡ trá»‹ nÃ y sáº½ Ä‘Æ°á»£c truyá»n vÃ o component qua <code>params</code> prop.</p>
</div>

```typescript
// app/products/[id]/page.tsx
interface ProductPageProps {
  params: {
    id: string
  }
}

export default function ProductPage({ params }: ProductPageProps) {
  const { id } = params
  
  return (
    <div className="container mx-auto p-4">
      <h1 className="text-2xl font-bold">Sáº£n pháº©m #{id}</h1>
      <p>Chi tiáº¿t sáº£n pháº©m cÃ³ ID: {id}</p>
    </div>
  )
}
```

### Catch-all Segments `[...slug]`

<div className="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400 mb-4">
  <p className="text-sm text-indigo-700"><strong>ğŸ’¡ Catch-all Segments:</strong> Báº¯t táº¥t cáº£ cÃ¡c segments sau vá»‹ trÃ­ nÃ y. Sá»­ dá»¥ng <code>[...param]</code> Ä‘á»ƒ match nhiá»u segments. VÃ­ dá»¥ <code>[...slug]</code> cÃ³ thá»ƒ match <code>/blog/2023</code>, <code>/blog/2023/post-1</code>, etc.</p>
</div>

```typescript
// app/blog/[...slug]/page.tsx
interface BlogPostProps {
  params: {
    slug: string[]
  }
}

export default function BlogPost({ params }: BlogPostProps) {
  const { slug } = params
  
  return (
    <div>
      <h1>Blog Post</h1>
      <p>Slug segments: {slug.join(' â†’ ')}</p>
    </div>
  )
}
```

### Optional Catch-all `[[...slug]]`

<div className="bg-teal-50 p-4 rounded-lg border-l-4 border-teal-400 mb-4">
  <p className="text-sm text-teal-700"><strong>ğŸ’¡ Optional Catch-all:</strong> Giá»‘ng Catch-all nhÆ°ng cÅ©ng match route gá»‘c. Sá»­ dá»¥ng <code>[[...param]]</code> vá»›i double brackets. VÃ­ dá»¥ <code>[[...slug]]</code> match cáº£ <code>/blog</code> vÃ  <code>/blog/category/post</code>.</p>
</div>

| URL | params.slug |
|-----|-------------|
| `/blog` | `undefined` |
| `/blog/post-1` | `['post-1']` |
| `/blog/2023/post-1` | `['2023', 'post-1']` |

## ğŸ“‚ Route Groups vÃ  Private Folders

### Route Groups `(folder)`

<div className="bg-blue-50 p-4 rounded-lg mb-4">
  <p className="text-sm text-blue-700"><strong>ğŸ’¡ Má»¥c Ä‘Ã­ch:</strong> Tá»• chá»©c code mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n URL structure</p>
</div>

```typescript
app/
â”œâ”€â”€ (marketing)/
â”‚   â”œâ”€â”€ about/page.tsx      // â†’ /about
â”‚   â””â”€â”€ contact/page.tsx    // â†’ /contact
â”œâ”€â”€ (shop)/
â”‚   â”œâ”€â”€ products/page.tsx   // â†’ /products
â”‚   â””â”€â”€ cart/page.tsx       // â†’ /cart
â””â”€â”€ page.tsx                // â†’ /
```

### Private Folders `_folder`

```typescript
app/
â”œâ”€â”€ _components/          // KhÃ´ng accessible qua URL
â”‚   â”œâ”€â”€ Header.tsx
â”‚   â””â”€â”€ Footer.tsx
â”œâ”€â”€ _lib/                // Utilities, khÃ´ng accessible
â”‚   â””â”€â”€ utils.ts
â””â”€â”€ products/
    â””â”€â”€ page.tsx         // â†’ /products
```

## ğŸ§­ Thá»±c hÃ nh: XÃ¢y dá»±ng Blog Structure

```mermaid
graph TD
    A[app] --> B[layout.tsx]
    A --> C[page.tsx Home]
    A --> D[blog]
    A --> E[about]
    A --> F[contact]
    
    D --> G[layout.tsx Blog Layout]
    D --> H[page.tsx Blog Home]
    D --> I[category]
    D --> J[slug]
    
    I --> K[category-param]
    K --> L[page.tsx Category Posts]
    
    J --> M[page.tsx Single Post]
```

### 1. Root Layout

```typescript
// app/layout.tsx
import './globals.css'

export const metadata = {
  title: 'My Blog',
  description: 'A Next.js blog with App Router',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="vi">
      <body className="min-h-screen bg-white">
        <nav className="bg-blue-600 text-white p-4">
          <div className="container mx-auto flex justify-between">
            <h1 className="text-xl font-bold">My Blog</h1>
            <div className="space-x-4">
              <a href="/" className="hover:underline">Home</a>
              <a href="/blog" className="hover:underline">Blog</a>
              <a href="/about" className="hover:underline">About</a>
            </div>
          </div>
        </nav>
        <main>{children}</main>
        <footer className="bg-gray-800 text-white p-8 mt-16">
          <div className="container mx-auto text-center">
            <p>&copy; 2024 My Blog. All rights reserved.</p>
          </div>
        </footer>
      </body>
    </html>
  )
}
```

### 2. Blog Layout

```typescript
// app/blog/layout.tsx
export default function BlogLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="container mx-auto px-4 py-8">
      <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <aside className="lg:col-span-1">
          <div className="bg-gray-100 p-4 rounded-lg">
            <h3 className="font-bold mb-4">Danh má»¥c</h3>
            <ul className="space-y-2">
              <li><a href="/blog/category/technology" className="text-blue-600 hover:underline">CÃ´ng nghá»‡</a></li>
              <li><a href="/blog/category/lifestyle" className="text-blue-600 hover:underline">Lá»‘i sá»‘ng</a></li>
              <li><a href="/blog/category/travel" className="text-blue-600 hover:underline">Du lá»‹ch</a></li>
            </ul>
          </div>
        </aside>
        <div className="lg:col-span-3">
          {children}
        </div>
      </div>
    </div>
  )
}
```

### 3. Dynamic Category Page

```typescript
// app/blog/category/[category]/page.tsx
interface CategoryPageProps {
  params: {
    category: string
  }
}

export default function CategoryPage({ params }: CategoryPageProps) {
  const { category } = params
  
  // Mock data - trong thá»±c táº¿ sáº½ fetch tá»« API
  const posts = [
    { id: 1, title: `BÃ i viáº¿t ${category} #1`, excerpt: 'MÃ´ táº£ ngáº¯n...' },
    { id: 2, title: `BÃ i viáº¿t ${category} #2`, excerpt: 'MÃ´ táº£ ngáº¯n...' },
  ]
  
  return (
    <div>
      <h1 className="text-3xl font-bold mb-8 capitalize">
        Danh má»¥c: {category.replace('-', ' ')}
      </h1>
      
      <div className="grid gap-6">
        {posts.map(post => (
          <article key={post.id} className="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <h2 className="text-xl font-semibold mb-2">
              <a href={`/blog/${post.id}`} className="text-blue-600 hover:underline">
                {post.title}
              </a>
            </h2>
            <p className="text-gray-600">{post.excerpt}</p>
          </article>
        ))}
      </div>
    </div>
  )
}
```

## ğŸ“Š Route Mapping Summary

### Static vs Dynamic Routes

| Route Type | CÃº phÃ¡p | VÃ­ dá»¥ URL | File path |
|------------|---------|-----------|-----------|
| **Static** | `folder/page.tsx` | `/about` | `app/about/page.tsx` |
| **Dynamic** | `[param]/page.tsx` | `/products/123` | `app/products/[id]/page.tsx` |
| **Catch-all** | `[...params]/page.tsx` | `/blog/2023/post-1` | `app/blog/[...slug]/page.tsx` |
| **Optional** | `[[...params]]/page.tsx` | `/shop` hoáº·c `/shop/category` | `app/shop/[[...slug]]/page.tsx` |

### Special Files trong App Router

| File | Má»¥c Ä‘Ã­ch | Báº¯t buá»™c |
|------|---------|----------|
| `layout.tsx` | Shared UI cho route vÃ  children | âœ… (Root layout) |
| `page.tsx` | UI duy nháº¥t cho route | âœ… |
| `loading.tsx` | Loading UI | âŒ |
| `error.tsx` | Error UI | âŒ |
| `not-found.tsx` | Not found UI | âŒ |

## ğŸ¯ BÃ i táº­p thá»±c hÃ nh

<div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 my-6">
  <h3 className="font-semibold text-yellow-800 mb-2">ğŸ“ Thá»±c hÃ nh</h3>
  <p className="text-sm text-yellow-700">XÃ¢y dá»±ng cáº¥u trÃºc routing cho má»™t website e-commerce vá»›i:</p>
  <ul className="list-disc list-inside text-sm text-yellow-700 mt-2 space-y-1">
    <li>Trang chá»§ (<code>/</code>)</li>
    <li>Danh sÃ¡ch sáº£n pháº©m (<code>/products</code>)</li>
    <li>Chi tiáº¿t sáº£n pháº©m (<code>/products/[id]</code>)</li>
    <li>Danh má»¥c sáº£n pháº©m (<code>/category/[category]</code>)</li>
    <li>Trang giá» hÃ ng (<code>/cart</code>)</li>
    <li>Trang vá» chÃºng tÃ´i (<code>/about</code>)</li>
  </ul>
</div>

## âœ¨ Tá»•ng káº¿t

- **App Router** sá»­ dá»¥ng folder-based routing thay vÃ¬ file-based
- **Dynamic routing** cho phÃ©p táº¡o routes linh hoáº¡t vá»›i `[param]` vÃ  `[...param]`
- **Route Groups** `(folder)` giÃºp tá»• chá»©c code mÃ  khÃ´ng áº£nh hÆ°á»Ÿng URL
- **Private folders** `_folder` chá»©a code khÃ´ng accessible qua URL
- **Special files** nhÆ° `layout.tsx`, `page.tsx`, `loading.tsx` cÃ³ vai trÃ² riÃªng biá»‡t

<div className="mt-8 p-6 border-2 border-green-200 rounded-lg bg-green-50">
  <h3 className="text-lg font-semibold text-green-800 mb-2">ğŸ‰ BÃ i há»c tiáº¿p theo</h3>
  <p className="text-green-700">BÃ i 6: Layouts, Templates vÃ  Navigation - Há»c cÃ¡ch táº¡o layout vÃ  Ä‘iá»u hÆ°á»›ng trong App Router</p>
</div>