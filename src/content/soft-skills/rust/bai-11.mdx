# BÃ i 11: MODULES VÃ€ CRATES

<div className="bg-gradient-to-r from-orange-400 to-red-500 text-white p-6 rounded-lg mb-6">
  <h2 className="text-2xl font-bold mb-2">ğŸ¯ Má»¤C TIÃŠU BÃ€I Há»ŒC</h2>
  <p className="text-lg">Tá»• chá»©c code hiá»‡u quáº£ vá»›i modules vÃ  quáº£n lÃ½ dependencies thÃ´ng qua crate system</p>
</div>

---

## ğŸ“š Ná»˜I DUNG CHÃNH

### 1. Module System Overview

<div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
  <h4 className="font-bold text-blue-800">KhÃ¡i niá»‡m Module</h4>
  <p>Module trong Rust giÃºp tá»• chá»©c code thÃ nh cÃ¡c namespace logic, kiá»ƒm soÃ¡t visibility vÃ  táº¡o ra cáº¥u trÃºc dá»± Ã¡n rÃµ rÃ ng.</p>
</div>

```mermaid
graph TD
    A[Crate Root] --> B[Module main]
    A --> C[Module utils]
    A --> D[Module config]
    C --> E[Submodule math]
    C --> F[Submodule string_ops]
    D --> G[Submodule database]
    D --> H[Submodule server]
```

### 2. CÃº phÃ¡p Module cÆ¡ báº£n

| Tá»« khÃ³a | Chá»©c nÄƒng | VÃ­ dá»¥ |
|---------|-----------|-------|
| `mod` | Äá»‹nh nghÄ©a module | `mod utils;` |
| `pub` | CÃ´ng khai visibility | `pub fn hello() {}` |
| `use` | Import items | `use std::collections::HashMap;` |
| `super` | Tham chiáº¿u module cha | `super::function()` |
| `self` | Tham chiáº¿u module hiá»‡n táº¡i | `self::function()` |

#### VÃ­ dá»¥ Module cÆ¡ báº£n:

```rust
// src/lib.rs hoáº·c src/main.rs
mod math_operations {
    pub fn add(a: i32, b: i32) -> i32 {
        a + b
    }
    
    fn multiply(a: i32, b: i32) -> i32 { // private function
        a * b
    }
    
    pub fn square(x: i32) -> i32 {
        multiply(x, x) // cÃ³ thá»ƒ gá»i private function trong cÃ¹ng module
    }
}

fn main() {
    let result = math_operations::add(5, 3);
    println!("5 + 3 = {}", result);
    
    let squared = math_operations::square(4);
    println!("4Â² = {}", squared);
}
```

### 3. File-based Modules

<div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
  <h4 className="font-bold text-yellow-800">Cáº¥u trÃºc Project vá»›i nhiá»u file</h4>
</div>

| Cáº¥u trÃºc thÆ° má»¥c | Module path | CÃ¡ch import |
|------------------|-------------|-------------|
| `src/lib.rs` | crate root | - |
| `src/utils.rs` | `crate::utils` | `mod utils;` |
| `src/utils/mod.rs` | `crate::utils` | `mod utils;` |
| `src/utils/math.rs` | `crate::utils::math` | `pub mod math;` in utils/mod.rs |

#### VÃ­ dá»¥ cáº¥u trÃºc project:

```
my_project/
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src/
    â”œâ”€â”€ main.rs
    â”œâ”€â”€ utils.rs
    â””â”€â”€ config/
        â”œâ”€â”€ mod.rs
        â”œâ”€â”€ database.rs
        â””â”€â”€ server.rs
```

**src/utils.rs:**
```rust
pub fn format_output(value: i32) -> String {
    format!("Result: {}", value)
}

pub fn validate_input(input: &str) -> bool {
    !input.is_empty() && input.len() <= 100
}
```

**src/config/mod.rs:**
```rust
pub mod database;
pub mod server;

pub use database::DatabaseConfig;
pub use server::ServerConfig;
```

### 4. Visibility Rules

```mermaid
graph LR
    A[Private by default] --> B["pub - Public"]
    B --> C["pub(crate) - Crate public"]
    C --> D["pub(super) - Parent module"]
    D --> E["pub(self) - Current module"]
    E --> F["pub(in path) - Specific scope"]
```

| Visibility | Pháº¡m vi truy cáº­p | VÃ­ dá»¥ |
|------------|------------------|-------|
| (khÃ´ng cÃ³) | Private trong module | `fn private_func()` |
| `pub` | Public cho táº¥t cáº£ | `pub fn public_func()` |
| `pub(crate)` | Public trong crate | `pub(crate) fn crate_func()` |
| `pub(super)` | Public cho module cha | `pub(super) fn parent_func()` |
| `pub(self)` | Public trong module hiá»‡n táº¡i | `pub(self) fn self_func()` |

```rust
mod outer {
    pub mod inner {
        pub fn public_function() {}
        pub(crate) fn crate_function() {}
        pub(super) fn parent_function() {}
        fn private_function() {}
    }
    
    pub fn call_functions() {
        inner::public_function();    // âœ… OK
        inner::crate_function();     // âœ… OK  
        inner::parent_function();    // âœ… OK (outer lÃ  parent cá»§a inner)
        // inner::private_function(); // âŒ Error - private
    }
}
```

### 5. Use Statements vÃ  Paths

<div className="bg-green-50 border-l-4 border-green-400 p-4 mb-4">
  <h4 className="font-bold text-green-800">CÃ¡c cÃ¡ch import</h4>
</div>

| Loáº¡i import | CÃº phÃ¡p | MÃ´ táº£ |
|-------------|---------|-------|
| Absolute path | `use crate::utils::math;` | Tá»« crate root |
| Relative path | `use super::utils;` | Tá»« module cha |
| Multiple imports | `use std::collections::{HashMap, HashSet};` | Import nhiá»u items |
| Rename | `use std::io::Result as IoResult;` | Äá»•i tÃªn khi import |
| Re-export | `pub use utils::math;` | Export láº¡i tá»« module khÃ¡c |

```rust
// VÃ­ dá»¥ sá»­ dá»¥ng use statements
use std::collections::HashMap;
use std::fs::{File, OpenOptions};
use std::io::Result as IoResult;

// Re-export Ä‘á»ƒ táº¡o API Ä‘Æ¡n giáº£n hÆ¡n
pub use crate::utils::math::Calculator;
pub use crate::config::{DatabaseConfig, ServerConfig};

// Import vá»›i nested path
use crate::{
    utils::{format_output, validate_input},
    config::database::connect
};
```

### 6. Crates vÃ  Dependencies

#### Cáº¥u trÃºc Cargo.toml:

```toml
[package]
name = "my_awesome_project"
version = "0.1.0"
edition = "2021"
authors = ["Your Name <email@example.com>"]
description = "A sample Rust project demonstrating modules and crates"

[dependencies]
serde = { version = "1.0", features = ["derive"] }
tokio = { version = "1.0", features = ["full"] }
clap = "4.0"

[dev-dependencies]
criterion = "0.4"

[lib]
name = "my_awesome_lib"
crate-type = ["lib"]
```

#### PhÃ¢n loáº¡i Crates:

| Loáº¡i Crate | MÃ´ táº£ | File entry point | Má»¥c Ä‘Ã­ch |
|------------|-------|------------------|----------|
| Binary crate | Executable program | `src/main.rs` | ChÆ°Æ¡ng trÃ¬nh chÃ­nh |
| Library crate | Reusable code | `src/lib.rs` | ThÆ° viá»‡n chia sáº» |
| Workspace | Multiple crates | `Cargo.toml` vá»›i `[workspace]` | Quáº£n lÃ½ multi-project |

### 7. Workspace Management

```mermaid
graph TD
    A[Root Workspace] --> B[web-server crate]
    A --> C[shared-models crate]
    A --> D[database crate]
    B --> C
    B --> D
    D --> C
```

**Cáº¥u trÃºc Workspace:**

```
my_workspace/
â”œâ”€â”€ Cargo.toml          # Root workspace config
â”œâ”€â”€ web-server/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ main.rs
â”œâ”€â”€ shared-models/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ lib.rs
â””â”€â”€ database/
    â”œâ”€â”€ Cargo.toml
    â””â”€â”€ src/
        â””â”€â”€ lib.rs
```

**Root Cargo.toml:**
```toml
[workspace]
members = ["web-server", "shared-models", "database"]
resolver = "2"

[workspace.dependencies]
serde = { version = "1.0", features = ["derive"] }
tokio = { version = "1.0", features = ["full"] }
```

### 8. Publishing Crates

| BÆ°á»›c | Lá»‡nh | MÃ´ táº£ |
|------|------|-------|
| 1 | `cargo login` | ÄÄƒng nháº­p crates.io |
| 2 | `cargo package` | Táº¡o package Ä‘á»ƒ kiá»ƒm tra |
| 3 | `cargo publish --dry-run` | Thá»­ publish (khÃ´ng thá»±c sá»±) |
| 4 | `cargo publish` | Publish lÃªn crates.io |

<div className="bg-red-50 border-l-4 border-red-400 p-4 mb-4">
  <h4 className="font-bold text-red-800">âš ï¸ LÆ°u Ã½ khi publish</h4>
  <ul className="mt-2 list-disc list-inside">
    <li>TÃªn crate pháº£i unique trÃªn crates.io</li>
    <li>Version theo semantic versioning (MAJOR.MINOR.PATCH)</li>
    <li>KhÃ´ng thá»ƒ unpublish version Ä‘Ã£ publish</li>
    <li>Cáº§n license vÃ  documentation tá»‘t</li>
  </ul>
</div>

## ğŸ› ï¸ THá»°C HÃ€NH

### BÃ i táº­p 1: Táº¡o Library Crate

Táº¡o má»™t thÆ° viá»‡n tÃ­nh toÃ¡n vá»›i cáº¥u trÃºc sau:

```rust
// src/lib.rs
pub mod basic_math {
    pub fn add(a: f64, b: f64) -> f64 {
        a + b
    }
    
    pub fn subtract(a: f64, b: f64) -> f64 {
        a - b
    }
}

pub mod advanced_math {
    pub fn power(base: f64, exp: f64) -> f64 {
        base.powf(exp)
    }
    
    pub fn factorial(n: u64) -> u64 {
        match n {
            0 | 1 => 1,
            _ => n * factorial(n - 1)
        }
    }
}

// Re-export Ä‘á»ƒ API Ä‘Æ¡n giáº£n hÆ¡n
pub use basic_math::*;
pub use advanced_math::{power, factorial};
```

### BÃ i táº­p 2: Multi-module Project

<div className="bg-indigo-100 p-4 rounded-lg">
  <h4 className="font-bold text-indigo-800 mb-2">ğŸ¯ Táº¡o má»™t há»‡ thá»‘ng quáº£n lÃ½ sinh viÃªn</h4>
  <p>Chia thÃ nh cÃ¡c module: student, course, grade, utils</p>
</div>

**Cáº¥u trÃºc dá»± Ã¡n:**
```
student_management/
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src/
    â”œâ”€â”€ main.rs
    â”œâ”€â”€ lib.rs
    â”œâ”€â”€ student/
    â”‚   â”œâ”€â”€ mod.rs
    â”‚   â””â”€â”€ model.rs
    â”œâ”€â”€ course/
    â”‚   â”œâ”€â”€ mod.rs
    â”‚   â””â”€â”€ model.rs
    â”œâ”€â”€ grade/
    â”‚   â”œâ”€â”€ mod.rs
    â”‚   â””â”€â”€ calculator.rs
    â””â”€â”€ utils/
        â”œâ”€â”€ mod.rs
        â””â”€â”€ validators.rs
```

## ğŸ“Š Báº¢NG Tá»”NG Káº¾T

### So sÃ¡nh Module vs Crate

| KhÃ­a cáº¡nh | Module | Crate |
|-----------|--------|-------|
| **Scope** | Namespace trong crate | Unit compilation Ä‘á»™c láº­p |
| **File** | CÃ³ thá»ƒ nhiá»u modules/file | Má»™t crate root |
| **Visibility** | pub/private trong crate | pub cho external crates |
| **Dependencies** | KhÃ´ng cÃ³ | Quáº£n lÃ½ qua Cargo.toml |
| **Distribution** | KhÃ´ng thá»ƒ | CÃ³ thá»ƒ publish lÃªn crates.io |

### Best Practices

<div className="bg-green-100 p-4 rounded-lg mb-4">
  <h4 className="font-bold text-green-800 mb-2">âœ… NÃªn lÃ m</h4>
  <ul className="list-disc list-inside space-y-1">
    <li>Tá»• chá»©c modules theo chá»©c nÄƒng logic</li>
    <li>Sá»­ dá»¥ng <code>pub use</code> Ä‘á»ƒ táº¡o API sáº¡ch</li>
    <li>Giá»¯ modules nhá» vÃ  táº­p trung</li>
    <li>Äáº·t tÃªn modules rÃµ rÃ ng, mÃ´ táº£ chá»©c nÄƒng</li>
  </ul>
</div>

<div className="bg-red-100 p-4 rounded-lg">
  <h4 className="font-bold text-red-800 mb-2">âŒ TrÃ¡nh</h4>
  <ul className="list-disc list-inside space-y-1">
    <li>Táº¡o modules quÃ¡ sÃ¢u (deep nesting)</li>
    <li>LÃ m public má»i thá»© khÃ´ng cáº§n thiáº¿t</li>
    <li>Äáº·t táº¥t cáº£ code trong má»™t file lá»›n</li>
    <li>Ignore compiler warnings vá» unused imports</li>
  </ul>
</div>

---

<div className="bg-gradient-to-r from-purple-400 to-pink-500 text-white p-6 rounded-lg mt-6">
  <h3 className="text-xl font-bold mb-2">ğŸ‰ Káº¾T LUáº¬N</h3>
  <p>Module system lÃ  má»™t trong nhá»¯ng tÃ­nh nÄƒng máº¡nh máº½ nháº¥t cá»§a Rust, giÃºp tá»• chá»©c code hiá»‡u quáº£ vÃ  táº¡o ra cÃ¡c thÆ° viá»‡n cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng. Viá»‡c thÃ nh tháº¡o modules vÃ  crates sáº½ giÃºp báº¡n xÃ¢y dá»±ng cÃ¡c dá»± Ã¡n Rust lá»›n má»™t cÃ¡ch chuyÃªn nghiá»‡p.</p>
</div>

**BÃ i tiáº¿p theo:** Traits - Shared Behavior ğŸš€