# BÃ€I 9: BORROWING, REFERENCES VÃ€ SLICES

<div className="bg-gradient-to-r from-orange-400 to-red-500 text-white p-6 rounded-lg shadow-lg mb-8">
  <h2 className="text-2xl font-bold mb-2">ğŸ¯ Má»¤C TIÃŠU BÃ€I Há»ŒC</h2>
  <p className="text-lg">Sá»­ dá»¥ng borrowing Ä‘á»ƒ truy cáº­p dá»¯ liá»‡u mÃ  khÃ´ng cáº§n chiáº¿m quyá»n sá»Ÿ há»¯u (ownership)</p>
</div>

## ğŸ“š Tá»”NG QUAN

Trong bÃ i nÃ y, chÃºng ta sáº½ há»c vá» **borrowing** - má»™t khÃ¡i niá»‡m quan trá»ng trong Rust cho phÃ©p truy cáº­p dá»¯ liá»‡u mÃ  khÃ´ng chiáº¿m quyá»n sá»Ÿ há»¯u. ÄÃ¢y lÃ  cÃ¡ch Rust Ä‘áº£m báº£o memory safety mÃ  váº«n cho phÃ©p code linh hoáº¡t vÃ  hiá»‡u quáº£.

```mermaid
graph TD
    A[Ownership System] --> B[Borrowing & References]
    B --> C[Immutable References]
    B --> D[Mutable References] 
    B --> E[Slices]
    E --> F[String Slices]
    E --> G[Array Slices]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style C fill:#bfb,stroke:#333,stroke-width:2px
    style D fill:#fbf,stroke:#333,stroke-width:2px
```

## ğŸ” 1. REFERENCES VÃ€ BORROWING

### 1.1 KhÃ¡i Niá»‡m CÆ¡ Báº£n

<div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
  <h4 className="font-semibold text-blue-800">ğŸ’¡ Äá»‹nh nghÄ©a</h4>
  <p><strong>Reference</strong> lÃ  má»™t con trá» cho phÃ©p truy cáº­p giÃ¡ trá»‹ mÃ  khÃ´ng chiáº¿m quyá»n sá»Ÿ há»¯u.</p>
  <p><strong>Borrowing</strong> lÃ  hÃ nh Ä‘á»™ng táº¡o reference Ä‘áº¿n má»™t giÃ¡ trá»‹.</p>
</div>

| Loáº¡i Reference | KÃ½ Hiá»‡u | Äáº·c Äiá»ƒm | Quy Táº¯c |
|----------------|---------|----------|---------|
| **Immutable** | `&T` | Chá»‰ Ä‘á»c | Nhiá»u references cÃ¹ng lÃºc |
| **Mutable** | `&mut T` | Äá»c + Ghi | Chá»‰ 1 reference táº¡i 1 thá»i Ä‘iá»ƒm |

### 1.2 Immutable References

```rust
fn main() {
    let s1 = String::from("hello");
    let len = calculate_length(&s1);  // Borrowing s1
    
    println!("Chuá»—i '{}' cÃ³ Ä‘á»™ dÃ i {}", s1, len);  // s1 váº«n cÃ³ thá»ƒ dÃ¹ng
}

fn calculate_length(s: &String) -> usize {
    s.len()
}  // s ra khá»i scope, nhÆ°ng khÃ´ng drop giÃ¡ trá»‹ vÃ¬ khÃ´ng sá»Ÿ há»¯u
```

```mermaid
graph LR
    A[s1: String] --> B["hello"]
    C[&s1] -.-> B
    
    style A fill:#bfb,stroke:#333,stroke-width:2px
    style C fill:#bbf,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5
```

### 1.3 Mutable References

```rust
fn main() {
    let mut s = String::from("hello");
    change(&mut s);
    println!("{}", s);  // "hello, world"
}

fn change(some_string: &mut String) {
    some_string.push_str(", world");
}
```

<div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
  <h4 className="font-semibold text-yellow-800">âš ï¸ LÆ°u Ã½ quan trá»ng</h4>
  <p>Chá»‰ cÃ³ thá»ƒ cÃ³ <strong>má»™t mutable reference</strong> táº¡i má»™t thá»i Ä‘iá»ƒm trong cÃ¹ng scope!</p>
</div>

## ğŸš« 2. QUY Táº®C BORROWING

### 2.1 Báº£ng Quy Táº¯c Chi Tiáº¿t

| TÃ¬nh Huá»‘ng | Immutable Ref | Mutable Ref | Káº¿t Quáº£ |
|------------|---------------|-------------|---------|
| Nhiá»u `&T` | âœ… | âŒ | OK |
| Má»™t `&mut T` | âŒ | âŒ | OK |
| `&T` + `&mut T` | âŒ | âŒ | Error |

### 2.2 VÃ­ Dá»¥ Vi Pháº¡m Quy Táº¯c

```rust
// âŒ Lá»—i: KhÃ´ng thá»ƒ cÃ³ mutable vÃ  immutable reference cÃ¹ng lÃºc
fn main() {
    let mut s = String::from("hello");
    
    let r1 = &s;        // OK
    let r2 = &s;        // OK  
    let r3 = &mut s;    // âŒ ERROR!
    
    println!("{}, {}, and {}", r1, r2, r3);
}
```

### 2.3 Pháº¡m Vi (Scope) cá»§a References

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &s;        // immutable reference
    let r2 = &s;        // immutable reference
    println!("{} and {}", r1, r2);
    // r1 vÃ  r2 khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng ná»¯a tá»« Ä‘Ã¢y

    let r3 = &mut s;    // âœ… OK! 
    println!("{}", r3);
}
```

## ğŸ“ 3. SLICES - REFERENCES Äáº¾N PHáº¦N Cá»¦A Dá»® LIá»†U

### 3.1 String Slices

<div className="bg-green-50 border-l-4 border-green-400 p-4 mb-4">
  <h4 className="font-semibold text-green-800">ğŸ¯ String Slice (`&str`)</h4>
  <p>Reference Ä‘áº¿n má»™t pháº§n cá»§a String hoáº·c string literal</p>
</div>

```rust
fn main() {
    let s = String::from("hello world");
    
    let hello = &s[0..5];   // "hello"
    let world = &s[6..11];  // "world"  
    let whole = &s[..];     // "hello world"
    
    println!("{}, {}, {}", hello, world, whole);
}
```

```mermaid
graph TD
    A["String: hello world"] 
    B["&s[0..5] â†’ hello"]
    C["&s[6..11] â†’ world"]
    D["&s[..] â†’ hello world"]
    
    A --> B
    A --> C  
    A --> D
    
    style A fill:#fbb,stroke:#333,stroke-width:2px
    style B fill:#bfb,stroke:#333,stroke-width:2px
    style C fill:#bbf,stroke:#333,stroke-width:2px
    style D fill:#fbf,stroke:#333,stroke-width:2px
```

### 3.2 CÃº PhÃ¡p Slice Range

| CÃº PhÃ¡p | MÃ´ Táº£ | VÃ­ Dá»¥ |
|---------|-------|--------|
| `&s[start..end]` | Tá»« start Ä‘áº¿n end-1 | `&s[0..5]` |
| `&s[start..]` | Tá»« start Ä‘áº¿n cuá»‘i | `&s[6..]` |
| `&s[..end]` | Tá»« Ä‘áº§u Ä‘áº¿n end-1 | `&s[..5]` |
| `&s[..]` | ToÃ n bá»™ string | `&s[..]` |

### 3.3 Array Slices

```rust
fn main() {
    let a = [1, 2, 3, 4, 5];
    
    let slice = &a[1..4];  // [2, 3, 4]
    println!("{:?}", slice);
    
    // Sá»­ dá»¥ng vá»›i function
    print_slice(&a[..3]);  // [1, 2, 3]
}

fn print_slice(slice: &[i32]) {
    for item in slice {
        println!("{}", item);
    }
}
```

## ğŸ› ï¸ 4. FUNCTIONS Vá»šI REFERENCES

### 4.1 Function Parameters vá»›i References

```rust
// Tá»‘t: Sá»­ dá»¥ng string slice thay vÃ¬ String reference
fn first_word(s: &str) -> &str {  // Nháº­n cáº£ &String vÃ  &str
    let bytes = s.as_bytes();
    
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }
    
    &s[..]
}

fn main() {
    let my_string = String::from("hello world");
    let word = first_word(&my_string[..]);  // String slice
    
    let my_string_literal = "hello world";
    let word = first_word(my_string_literal);  // String literal
}
```

### 4.2 Returning References

<div className="bg-red-50 border-l-4 border-red-400 p-4 mb-4">
  <h4 className="font-semibold text-red-800">âš ï¸ Dangling References</h4>
  <p>Rust ngÄƒn cháº·n viá»‡c tráº£ vá» references Ä‘áº¿n dá»¯ liá»‡u sáº½ bá»‹ há»§y</p>
</div>

```rust
// âŒ Lá»—i: Dangling reference
fn dangle() -> &String {  // ERROR!
    let s = String::from("hello");
    &s  // s sáº½ bá»‹ drop khi function káº¿t thÃºc
}  

// âœ… ÄÃºng: Return ownership
fn no_dangle() -> String {
    let s = String::from("hello");
    s  // Move ownership ra ngoÃ i
}
```

## ğŸ’» 5. THá»°C HÃ€NH: TEXT PROCESSING

### BÃ i Táº­p 1: TÃ¬m tá»« Ä‘áº§u tiÃªn

```rust
fn first_word(s: &str) -> Option<&str> {
    for (i, &byte) in s.as_bytes().iter().enumerate() {
        if byte == b' ' {
            return Some(&s[..i]);
        }
    }
    
    if s.is_empty() {
        None
    } else {
        Some(s)
    }
}

fn main() {
    let sentence = "Rust programming language";
    
    match first_word(sentence) {
        Some(word) => println!("Tá»« Ä‘áº§u tiÃªn: {}", word),
        None => println!("Chuá»—i rá»—ng"),
    }
}
```

### BÃ i Táº­p 2: Search Function

```rust
fn find_substring(text: &str, pattern: &str) -> Option<usize> {
    text.find(pattern)
}

fn count_occurrences(text: &str, pattern: &str) -> usize {
    text.matches(pattern).count()
}

fn main() {
    let text = "Rust is fast. Rust is safe. Rust is productive.";
    let pattern = "Rust";
    
    if let Some(pos) = find_substring(text, pattern) {
        println!("TÃ¬m tháº¥y '{}' táº¡i vá»‹ trÃ­: {}", pattern, pos);
    }
    
    let count = count_occurrences(text, pattern);
    println!("'{}' xuáº¥t hiá»‡n {} láº§n", pattern, count);
}
```

## ğŸ“Š 6. SO SÃNH OWNERSHIP VS BORROWING

| KhÃ­a Cáº¡nh | Ownership | Borrowing |
|-----------|-----------|-----------|
| **Memory** | Chuyá»ƒn quyá»n sá»Ÿ há»¯u | Chá»‰ mÆ°á»£n temporary |
| **Performance** | CÃ³ thá»ƒ copy/move | Zero-cost abstractions |
| **Flexibility** | Háº¡n cháº¿ | Linh hoáº¡t hÆ¡n |
| **Safety** | Compiler guarantee | Compile-time checks |

```mermaid
flowchart TD
    A[Cáº§n sá»­ dá»¥ng data?] 
    B{Cáº§n modify?}
    C{Nhiá»u nÆ¡i cÃ¹ng dÃ¹ng?}
    D[Move Ownership]
    E[&mut T]
    F[&T] 
    G[Clone/Copy]
    
    A --> B
    B -->|CÃ³| C
    B -->|KhÃ´ng| F
    C -->|KhÃ´ng| E  
    C -->|CÃ³| G
    C -->|KhÃ´ng modify| F
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style F fill:#bfb,stroke:#333,stroke-width:2px
    style E fill:#fbf,stroke:#333,stroke-width:2px
```

## âœ… 7. TÃ“M Táº®T & ÄIá»‚M QUAN TRá»ŒNG

<div className="bg-gray-50 p-6 rounded-lg">
  <h3 className="text-xl font-bold mb-4 text-gray-800">ğŸ”‘ Nhá»¯ng Ä‘iá»ƒm then chá»‘t</h3>
  
  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div className="bg-blue-100 p-4 rounded">
      <h4 className="font-semibold text-blue-800">References</h4>
      <ul className="text-sm mt-2 space-y-1">
        <li>â€¢ `&T`: immutable reference</li>
        <li>â€¢ `&mut T`: mutable reference</li>
        <li>â€¢ Zero-cost abstractions</li>
      </ul>
    </div>
    
    <div className="bg-green-100 p-4 rounded">
      <h4 className="font-semibold text-green-800">Borrowing Rules</h4>
      <ul className="text-sm mt-2 space-y-1">
        <li>â€¢ Nhiá»u immutable refs OK</li>
        <li>â€¢ Má»™t mutable ref OK</li>
        <li>â€¢ KhÃ´ng mix immutable + mutable</li>
      </ul>
    </div>
    
    <div className="bg-purple-100 p-4 rounded">
      <h4 className="font-semibold text-purple-800">Slices</h4>
      <ul className="text-sm mt-2 space-y-1">
        <li>â€¢ `&str`: string slices</li>
        <li>â€¢ `&[T]`: array slices</li>
        <li>â€¢ Range syntax: `[start..end]`</li>
      </ul>
    </div>
    
    <div className="bg-orange-100 p-4 rounded">
      <h4 className="font-semibold text-orange-800">Best Practices</h4>
      <ul className="text-sm mt-2 space-y-1">
        <li>â€¢ Prefer `&str` over `&String`</li>
        <li>â€¢ Use slices cho flexibility</li>
        <li>â€¢ Avoid dangling references</li>
      </ul>
    </div>
  </div>
</div>

---

<div className="bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-lg mt-8">
  <h3 className="text-lg font-bold">ğŸš€ BÃ i Tiáº¿p Theo</h3>
  <p>BÃ i 10: Error Handling - Xá»­ lÃ½ errors má»™t cÃ¡ch an toÃ n vá»›i Result vÃ  Option</p>
</div>