# BÃ i 12: Traits - Shared Behavior

<div className="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg mb-8">
  <h2 className="text-2xl font-bold mb-2">ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2>
  <p className="text-lg">Äá»‹nh nghÄ©a shared behavior vá»›i traits vÃ  sá»­ dá»¥ng chÃºng Ä‘á»ƒ táº¡o code linh hoáº¡t, cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng</p>
</div>

## ğŸ“š Giá»›i thiá»‡u vá» Traits

**Traits** trong Rust lÃ  cÃ¡ch Ä‘á»ƒ Ä‘á»‹nh nghÄ©a shared behavior (hÃ nh vi chung) giá»¯a cÃ¡c types khÃ¡c nhau. Traits tÆ°Æ¡ng tá»± nhÆ° interfaces trong cÃ¡c ngÃ´n ngá»¯ khÃ¡c nhÆ°ng máº¡nh máº½ hÆ¡n.

<div className="bg-yellow-100 border-l-4 border-yellow-500 p-4 mb-6">
  <p className="font-semibold text-yellow-800">ğŸ’¡ KhÃ¡i niá»‡m quan trá»ng:</p>
  <p className="text-yellow-700">Trait Ä‘á»‹nh nghÄ©a má»™t táº­p há»£p cÃ¡c method signatures mÃ  cÃ¡c type cÃ³ thá»ƒ implement Ä‘á»ƒ chia sáº» behavior chung.</p>
</div>

## ğŸ” CÃº phÃ¡p cÆ¡ báº£n cá»§a Traits

### Äá»‹nh nghÄ©a Trait

```rust
trait Summary {
    fn summarize(&self) -> String;
}
```

### Implementing Trait cho Struct

```rust
struct NewsArticle {
    pub headline: String,
    pub location: String,
    pub author: String,
    pub content: String,
}

impl Summary for NewsArticle {
    fn summarize(&self) -> String {
        format!("{}, by {} ({})", self.headline, self.author, self.location)
    }
}
```

## ğŸ“Š So sÃ¡nh Traits vá»›i cÃ¡c khÃ¡i niá»‡m khÃ¡c

| KhÃ¡i niá»‡m | Rust Traits | Java Interfaces | C++ Abstract Classes |
|-----------|-------------|-----------------|---------------------|
| **Multiple Implementation** | âœ… CÃ³ | âœ… CÃ³ | âŒ KhÃ´ng |
| **Default Methods** | âœ… CÃ³ | âœ… CÃ³ (Java 8+) | âœ… CÃ³ |
| **Associated Types** | âœ… CÃ³ | âŒ KhÃ´ng | âŒ KhÃ´ng |
| **Static Dispatch** | âœ… CÃ³ | âŒ KhÃ´ng | âœ… CÃ³ |
| **Dynamic Dispatch** | âœ… CÃ³ (trait objects) | âœ… CÃ³ | âœ… CÃ³ |

## ğŸ¨ Default Trait Implementations

Traits cÃ³ thá»ƒ cung cáº¥p default implementations cho methods:

```rust
trait Summary {
    fn summarize_author(&self) -> String;

    fn summarize(&self) -> String {
        format!("(Read more from {}...)", self.summarize_author())
    }
}

struct Tweet {
    pub username: String,
    pub content: String,
    pub reply: bool,
    pub retweet: bool,
}

impl Summary for Tweet {
    fn summarize_author(&self) -> String {
        format!("@{}", self.username)
    }
    // summarize() method sá»­ dá»¥ng default implementation
}
```

## ğŸ“ˆ SÆ¡ Ä‘á»“ quan há»‡ Traits

```mermaid
graph TD
    A[Trait Definition] --> B[Default Methods]
    A --> C[Required Methods]
    
    D[Type A] --> E[implements Trait]
    F[Type B] --> E
    G[Type C] --> E
    
    E --> H[Can use trait methods]
    E --> I[Polymorphic behavior]
    
    style A fill:#e1f5fe
    style E fill:#f3e5f5
    style H fill:#e8f5e8
    style I fill:#fff3e0
```

## ğŸ”§ Trait Bounds trong Functions

### Function Parameters vá»›i Traits

```rust
pub fn notify(item: &impl Summary) {
    println!("Breaking news! {}", item.summarize());
}

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:
pub fn notify<T: Summary>(item: &T) {
    println!("Breaking news! {}", item.summarize());
}
```

### Multiple Trait Bounds

| CÃº phÃ¡p | MÃ´ táº£ | VÃ­ dá»¥ |
|---------|-------|--------|
| `T: Trait1 + Trait2` | Type T pháº£i implement cáº£ Trait1 vÃ  Trait2 | `fn func<T: Display + Clone>(t: T)` |
| `where` clause | Syntax rÃµ rÃ ng hÆ¡n cho complex bounds | `fn func<T>(t: T) where T: Display + Clone` |

```rust
use std::fmt::Display;

pub fn notify_and_return<T>(item: &T) -> String 
where 
    T: Summary + Display,
{
    format!("Item: {}, Summary: {}", item, item.summarize())
}
```

## ğŸ—ï¸ Associated Types trong Traits

Associated types lÃ m cho trait definitions linh hoáº¡t hÆ¡n:

```rust
pub trait Iterator {
    type Item;

    fn next(&mut self) -> Option<Self::Item>;
}

struct Counter {
    current: usize,
    max: usize,
}

impl Iterator for Counter {
    type Item = usize;

    fn next(&mut self) -> Option<Self::Item> {
        if self.current < self.max {
            let current = self.current;
            self.current += 1;
            Some(current)
        } else {
            None
        }
    }
}
```

## ğŸ“‹ Common Standard Library Traits

<div className="bg-gray-50 p-4 rounded-lg mb-6">

### Danh sÃ¡ch Traits quan trá»ng

| Trait | Má»¥c Ä‘Ã­ch | Method chÃ­nh | Auto-derive |
|-------|----------|---------------|-------------|
| `Debug` | Format debugging | `fmt(&self, f: &mut Formatter)` | âœ… |
| `Clone` | Deep copying | `clone(&self) -> Self` | âœ… |
| `Copy` | Bit-wise copying | (marker trait) | âœ… |
| `PartialEq` | Equality comparison | `eq(&self, other: &Self) -> bool` | âœ… |
| `Ord` | Total ordering | `cmp(&self, other: &Self) -> Ordering` | âœ… |
| `Display` | User-facing format | `fmt(&self, f: &mut Formatter)` | âŒ |

</div>

### VÃ­ dá»¥ sá»­ dá»¥ng Derive Macros

```rust
#[derive(Debug, Clone, PartialEq)]
struct Point {
    x: i32,
    y: i32,
}

fn main() {
    let p1 = Point { x: 1, y: 2 };
    let p2 = p1.clone();
    
    println!("p1: {:?}", p1);  // Debug trait
    println!("p1 == p2: {}", p1 == p2);  // PartialEq trait
}
```

## ğŸµ Thá»±c hÃ nh: Media Player System

XÃ¢y dá»±ng há»‡ thá»‘ng media player vá»›i traits:

```rust
// Äá»‹nh nghÄ©a trait chung cho media
trait Playable {
    fn play(&self);
    fn pause(&self);
    fn stop(&self);
    
    // Default implementation
    fn get_info(&self) -> String {
        String::from("Media file")
    }
}

trait Metadata {
    fn duration(&self) -> u32;
    fn title(&self) -> &str;
    fn artist(&self) -> &str;
}

// Audio file implementation
struct AudioFile {
    title: String,
    artist: String,
    duration: u32,
    file_path: String,
}

impl Playable for AudioFile {
    fn play(&self) {
        println!("ğŸµ Playing audio: {}", self.title);
    }
    
    fn pause(&self) {
        println!("â¸ï¸ Pausing audio: {}", self.title);
    }
    
    fn stop(&self) {
        println!("â¹ï¸ Stopping audio: {}", self.title);
    }
    
    fn get_info(&self) -> String {
        format!("Audio: {} by {}", self.title, self.artist)
    }
}

impl Metadata for AudioFile {
    fn duration(&self) -> u32 { self.duration }
    fn title(&self) -> &str { &self.title }
    fn artist(&self) -> &str { &self.artist }
}

// Video file implementation
struct VideoFile {
    title: String,
    duration: u32,
    resolution: String,
    file_path: String,
}

impl Playable for VideoFile {
    fn play(&self) {
        println!("ğŸ¬ Playing video: {} ({})", self.title, self.resolution);
    }
    
    fn pause(&self) {
        println!("â¸ï¸ Pausing video: {}", self.title);
    }
    
    fn stop(&self) {
        println!("â¹ï¸ Stopping video: {}", self.title);
    }
    
    fn get_info(&self) -> String {
        format!("Video: {} ({})", self.title, self.resolution)
    }
}
```

## ğŸ”„ Trait Objects vÃ  Dynamic Dispatch

```mermaid
flowchart TD
    A[Static Dispatch] --> B["impl Trait"]
    A --> C["Generic <T: Trait>"]
    
    D[Dynamic Dispatch] --> E["dyn Trait"]
    D --> F["Box<dyn Trait>"]
    
    B --> G[Compile-time resolution]
    C --> G
    E --> H[Runtime resolution]
    F --> H
    
    style A fill:#e3f2fd
    style D fill:#fff3e0
    style G fill:#e8f5e8
    style H fill:#ffebee
```

### Sá»­ dá»¥ng Trait Objects

```rust
// Function nháº­n trait objects
fn play_media(media: &dyn Playable) {
    println!("{}", media.get_info());
    media.play();
}

// Collection cá»§a trait objects
fn create_playlist() -> Vec<Box<dyn Playable>> {
    vec![
        Box::new(AudioFile {
            title: "Bohemian Rhapsody".to_string(),
            artist: "Queen".to_string(),
            duration: 355,
            file_path: "music/queen.mp3".to_string(),
        }),
        Box::new(VideoFile {
            title: "Inception".to_string(),
            duration: 8880,
            resolution: "1080p".to_string(),
            file_path: "movies/inception.mp4".to_string(),
        }),
    ]
}
```

## âš¡ Performance: Static vs Dynamic Dispatch

<div className="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-6">

### So sÃ¡nh Performance

| Loáº¡i Dispatch | Æ¯u Ä‘iá»ƒm | NhÆ°á»£c Ä‘iá»ƒm | Khi nÃ o sá»­ dá»¥ng |
|---------------|---------|------------|-----------------|
| **Static** | â€¢ Zero-cost abstraction<br />â€¢ Compiler optimization<br />â€¢ No runtime overhead | â€¢ Code duplication<br />â€¢ Larger binary size | â€¢ Performance critical<br />â€¢ Known types at compile time |
| **Dynamic** | â€¢ Flexible at runtime<br />â€¢ Smaller binary size<br />â€¢ Heterogeneous collections | â€¢ Runtime overhead<br />â€¢ Virtual function calls | â€¢ Unknown types at runtime<br />â€¢ Plugin systems |

</div>

## ğŸ¯ BÃ i táº­p thá»±c hÃ nh

<div className="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
  <h3 className="text-lg font-semibold text-green-800">ğŸ† Challenge: HoÃ n thiá»‡n Media Player</h3>
  <div className="text-green-700">
    <p><strong>YÃªu cáº§u:</strong></p>
    <ul className="list-disc list-inside mt-2 space-y-1">
      <li>ThÃªm trait <code>Seekable</code> vá»›i methods <code>seek_to(position: u32)</code></li>
      <li>Implement trait <code>Display</code> cho cÃ¡c media types</li>
      <li>Táº¡o struct <code>PlaylistManager</code> quáº£n lÃ½ danh sÃ¡ch media</li>
      <li>Sá»­ dá»¥ng generic functions vá»›i trait bounds</li>
    </ul>
  </div>
</div>

## ğŸ” Debugging Traits

### Common Errors vÃ  Solutions

| Error | NguyÃªn nhÃ¢n | Giáº£i phÃ¡p |
|-------|-------------|-----------|
| `trait bound not satisfied` | Type chÆ°a implement required trait | Implement trait hoáº·c thÃªm trait bound |
| `cannot be made into an object` | Trait khÃ´ng object-safe | Remove generic methods hoáº·c Self parameters |
| `conflicting implementations` | Multiple implementations cho same type | Use newtype pattern hoáº·c different trait |

## ğŸ“ TÃ³m táº¯t chÆ°Æ¡ng

<div className="bg-gray-900 text-white p-6 rounded-lg">
  <h3 className="text-xl font-bold mb-4">ğŸ”‘ Äiá»ƒm quan trá»ng cáº§n nhá»›</h3>
  <ul className="space-y-2">
    <li>â€¢ <strong>Traits</strong> Ä‘á»‹nh nghÄ©a shared behavior giá»¯a cÃ¡c types</li>
    <li>â€¢ <strong>Default implementations</strong> giÃºp tÃ¡i sá»­ dá»¥ng code</li>
    <li>â€¢ <strong>Trait bounds</strong> enable generic programming</li>
    <li>â€¢ <strong>Associated types</strong> lÃ m traits linh hoáº¡t hÆ¡n</li>
    <li>â€¢ <strong>Static dispatch</strong> vs <strong>Dynamic dispatch</strong> cÃ³ trade-offs khÃ¡c nhau</li>
    <li>â€¢ <strong>Standard library traits</strong> cung cáº¥p functionality cÆ¡ báº£n</li>
  </ul>
</div>

## ğŸš€ Chuáº©n bá»‹ cho bÃ i tiáº¿p theo

BÃ i 13 sáº½ táº­p trung vÃ o **Generics vÃ  Type-level Programming**, nÆ¡i báº¡n sáº½ há»c cÃ¡ch káº¿t há»£p traits vá»›i generics Ä‘á»ƒ táº¡o ra code cá»±c ká»³ linh hoáº¡t vÃ  máº¡nh máº½.

---

<div className="text-center text-gray-600 mt-8">
  <p>ğŸ“š <strong>KhÃ³a há»c Rust - BÃ i 12/18</strong></p>
  <p>Prepared with â¤ï¸ for Rust learners</p>
</div>